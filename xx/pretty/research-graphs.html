<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Warzone 2100 Autohoster — Research: Graphs</title>
  <link rel="stylesheet" href="./css/style.css" />
  <style>
    .grid{display:grid;gap:12px;grid-template-columns:repeat(12,1fr)}
    .card{grid-column:span 12;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px}
    @media(min-width:980px){ .half{grid-column:span 6} .third{grid-column:span 4} }
    .controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    select,input{background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.16);color:inherit;border-radius:10px;padding:8px 10px}
    button{border-radius:10px;padding:8px 10px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.06);color:inherit;cursor:pointer}
    button:hover{background:rgba(255,255,255,.10)}
    .muted{opacity:.75}
    .kpi{display:flex;gap:10px;align-items:baseline;flex-wrap:wrap}
    .kpi .big{font-size:28px;font-weight:800;letter-spacing:.2px}
    .kpi .label{opacity:.8}
    canvas{width:100% !important; height:320px !important;}
    @media(min-width:980px){ canvas.tall{height:360px !important;} }
    .row{display:flex;justify-content:space-between;gap:12px;padding:8px 0;border-top:1px solid rgba(255,255,255,.08)}
    .row:first-child{border-top:0}
    .badge{font-weight:800}
    .pill{display:inline-block;padding:3px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.18);opacity:.9;font-size:12px}
    .small{font-size:12px}
  </style>

  <!-- Chart.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <header class="topbar">
  <div class="brand">Warzone 2100 Autohoster</div>
  <nav class="nav">
    <a class="navlink" data-nav="home" href="./">Home</a>
    <a class="navlink" data-nav="games" href="./games.html">Games</a>
    <a class="navlink" data-nav="players" href="./players.html">Players</a>
    <a class="navlink" data-nav="lobby" href="./lobby.html">Lobby</a>
    <a class="navlink" data-nav="leaderboard" href="./top.html">Leaderboard</a>
  </nav>
</header>

  <main class="wrap">
    <section class="page">
      <h1>Research Graphs</h1>
      <p class="muted">
        Uses the same <span class="pill">/jsons/matchstats.json</span> as Research+.
        Graphs are derived from <span class="pill">researchComplete</span> + <span class="pill">players</span> + <span class="pill">duration_s</span>.
      </p>

      <div class="controls card" style="margin:12px 0">
        <button id="btnRefresh">Refresh</button>
        <span class="muted" id="status">Loading…</span>
        <span style="flex:1"></span>

        <label class="muted">Scope</label>
        <select id="scope">
          <option value="all">All time</option>
          <option value="30">Last 30 days</option>
          <option value="7">Last 7 days</option>
        </select>

        <label class="muted">Min games</label>
        <select id="minGames">
          <option value="1">1</option>
          <option value="3" selected>3</option>
          <option value="5">5</option>
          <option value="10">10</option>
        </select>

        <label class="muted">Player</label>
        <select id="playerPick">
          <option value="">All players</option>
        </select>
      </div>

      <div class="grid">
        <div class="card third">
          <div class="kpi"><span class="big" id="kGames">—</span><span class="label">games</span></div>
          <div class="kpi"><span class="big" id="kTechs">—</span><span class="label">completed techs</span></div>
          <div class="kpi"><span class="big" id="kPlayers">—</span><span class="label">players</span></div>
          <div class="muted small" id="kNote" style="margin-top:8px"></div>
        </div>

        <div class="card third">
          <h3 style="margin:0 0 8px 0">Category Share</h3>
          <div class="muted small">What you (or everyone) researches most.</div>
          <canvas id="catPie"></canvas>
        </div>

        <div class="card third">
          <h3 style="margin:0 0 8px 0">Top Categories</h3>
          <div class="muted small">Counts by category (same data as pie).</div>
          <div id="catList" style="margin-top:8px"></div>
        </div>

        <div class="card half">
          <h3 style="margin:0 0 8px 0">Tech Tempo by Game</h3>
          <div class="muted small">Completed techs per minute (per game). Helps spot “rush” games.</div>
          <canvas id="tempoLine" class="tall"></canvas>
        </div>

        <div class="card half">
          <h3 style="margin:0 0 8px 0">Earliest Category Unlocks</h3>
          <div class="muted small">Fastest completion time (mm:ss) for each category in the current scope.</div>
          <canvas id="firstBar" class="tall"></canvas>
        </div>

        <div class="card">
          <h3 style="margin:0 0 8px 0">Top Tech IDs (raw)</h3>
          <div class="muted small">Most completed research IDs (good for spotting meta).</div>
          <canvas id="topTechBar" class="tall"></canvas>
        </div>
      </div>
    </section>
  </main>

  <script src="./js/research-graphs.js"></script>
  <script src="./js/nav-active.js"></script>

<!-- Matomo -->
<script>
  (function() {
    if (/github\.io$/i.test(window.location.hostname)) {
      return;
    }
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="/matomo/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  })();
</script>
<!-- End Matomo Code -->

</body>
</html>
