<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Warzone 2100 Autohoster â€” Research Timeline</title>
  <link rel="stylesheet" href="./css/style.css" />
  <style>
    :root{
      --bg:#f6f7fb;
      --panel:#ffffff;
      --panel2:#fbfbfd;
      --border:rgba(16,24,40,.12);
      --text:#0f172a;
      --muted:rgba(15,23,42,.70);
      --chip:rgba(15,23,42,.06);
      --shadow:0 12px 30px rgba(2,6,23,.12);
      --techIcon:44px;
    }
    body{color:var(--text); background:var(--bg)}
    .muted{opacity:1;color:var(--muted)}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:12px 14px;box-shadow: 0 1px 0 rgba(2,6,23,.04)}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    select,input{background:var(--panel2);border:1px solid rgba(16,24,40,.18);color:inherit;border-radius:10px;padding:8px 10px}
    button{border-radius:10px;padding:8px 10px;border:1px solid rgba(16,24,40,.18);background:rgba(15,23,42,.06);color:inherit;cursor:pointer}
    button:hover{background:rgba(15,23,42,.10)}
    .pill{display:inline-block;padding:3px 8px;border-radius:999px;border:1px solid rgba(16,24,40,.14);opacity:.95;font-size:12px;background:rgba(15,23,42,.04)}
    .kpis{display:flex;gap:14px;flex-wrap:wrap}
    .kpi .big{font-size:26px;font-weight:900}
    .kpi .lab{color:var(--muted)}
    .split{display:grid;grid-template-columns: 1fr; gap:12px}
    @media(min-width:980px){ .split{grid-template-columns: 360px 1fr;} }

    .timelineWrap{border:1px solid var(--border);border-radius:14px;overflow:hidden;background:var(--panel)}
    .timelineTop{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid rgba(16,24,40,.10);background:var(--panel2)}
    .legend{display:flex;gap:8px;flex-wrap:wrap}
    .dot{width:10px;height:10px;border-radius:50%}
    .chip{display:inline-flex;gap:6px;align-items:center;padding:5px 8px;border-radius:999px;border:1px solid rgba(16,24,40,.14);background:var(--chip);font-size:12px;color:var(--muted)}

    .tableWrap{overflow:auto; max-height: 72vh; background:var(--panel)}
    table{border-collapse:separate;border-spacing:0; width:max-content; min-width:100%;}
    thead th{position:sticky; top:0; z-index:3; background:rgba(255,255,255,.92); backdrop-filter: blur(6px); border-bottom:1px solid rgba(16,24,40,.12)}
    th,td{padding:10px 10px; border-right:1px solid rgba(16,24,40,.08); vertical-align:top;}
    th:first-child, td:first-child{position:sticky; left:0; z-index:2; background:rgba(255,255,255,.92); backdrop-filter: blur(6px); border-right:1px solid rgba(16,24,40,.14); min-width:110px}
    th{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.08em}
    .time{font-variant-numeric: tabular-nums; font-weight:900}
    .cell{min-width:220px; max-width:320px}

    .event{padding:8px 10px;border-radius:12px;border:1px solid rgba(16,24,40,.14);background:rgba(255,255,255,.85);box-shadow: 0 1px 0 rgba(2,6,23,.04) inset; margin-bottom:8px}
    .event:last-child{margin-bottom:0}
    .evTitle{font-weight:900;display:flex;align-items:center;gap:8px;min-width:0}.evName{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;min-width:0}.tech-icon{width:var(--techIcon);height:var(--techIcon);border-radius:12px;border:1px solid rgba(16,24,40,.14);background:rgba(15,23,42,.04);image-rendering:pixelated;flex:0 0 auto}.tech-icon.is-fallback{opacity:.75}
    .evMeta{display:flex;gap:10px;flex-wrap:wrap;margin-top:4px;color:var(--muted);font-size:12px}
    .tag{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid rgba(16,24,40,.14);background:rgba(15,23,42,.04)}
    .dim{opacity:.65}

    .tip{position:fixed;display:none;z-index:9999;max-width:360px;background:rgba(255,255,255,.98);
      border:1px solid rgba(16,24,40,.18);border-radius:14px;box-shadow:var(--shadow);padding:10px 12px;pointer-events:none}

    /* Game search list */
    .results{margin-top:10px;border-top:1px solid rgba(16,24,40,.10);padding-top:10px;max-height:52vh;overflow:auto}
    .gitem{display:flex;gap:10px;align-items:flex-start;justify-content:space-between;padding:10px 10px;border:1px solid rgba(16,24,40,.10);
      border-radius:12px;background:rgba(15,23,42,.03);margin-bottom:8px;cursor:pointer}
    .gitem:hover{background:rgba(15,23,42,.06)}
    .gtitle{font-weight:900}
    .gsub{color:var(--muted);font-size:12px;margin-top:2px}
    .gmeta{color:var(--muted);font-size:12px;white-space:nowrap}
    .small{font-size:12px}
  
    /* === Minimal mode: show ONLY the timeline box === */
    .page > h1,
    .page > p.muted,
    .controls,
    .split > .card { display:none !important; }

    .split{ grid-template-columns: 1fr !important; }
    .timelineWrap{ width:100% !important; }
    .wrap{ max-width: 1400px; }
    /* tighten top spacing */
    .page{ padding-top: 10px; }


/* === Compact default: show MORE on screen === */
:root{
  --cellPad: 6px;
  --cardPad: 8px;
  --cardRadius: 10px;
}
.timelineTop{
  padding: 8px 10px !important;
  font-size: 12px !important;
}
.timelineTop .muted{ font-size: 12px !important; }
table{ font-size: 13px !important; }

th, td{
  padding: 8px 10px !important;
}
th{
  font-size: 12px !important;
  letter-spacing: .06em !important;
}
.timeCol{
  width: 86px !important;
}
.timeCell{
  font-size: 14px !important;
}
.cell{
  padding: var(--cellPad) !important;
}

.card{
  padding: var(--cardPad) !important;
  border-radius: var(--cardRadius) !important;
  border-width: 1px !important;
}
.card h4{
  font-size: 16px !important;
  margin: 0 0 4px 0 !important;
  line-height: 1.1 !important;
}
.badges{
  gap: 6px !important;
}
.badge{
  font-size: 12px !important;
  padding: 2px 8px !important;
}
.badge.small{
  font-size: 11px !important;
  padding: 1px 8px !important;
}
.card .meta{
  font-size: 12px !important;
}

/* make rows feel tighter */
tbody tr td{
  vertical-align: top !important;
}


/* === Ultra-slim: fit WAY more on screen === */
th, td{ padding: 4px 8px !important; }
.timeCol{ width: 70px !important; }
.timeCell{ font-size: 13px !important; }

.cell{ padding: 4px !important; }

.card{
  padding: 6px 8px !important;
  border-radius: 10px !important;
  max-width: 360px !important;
}
.card h4{
  font-size: 14px !important;
  margin: 0 0 2px 0 !important;
  line-height: 1.05 !important;
  white-space: nowrap !important;
  overflow: hidden !important;
  text-overflow: ellipsis !important;
}
.badges{ gap: 4px !important; flex-wrap: wrap !important; }
.badge{
  font-size: 11px !important;
  padding: 1px 6px !important;
}
.badge.small{
  font-size: 10px !important;
  padding: 1px 6px !important;
}

/* reduce vertical whitespace in timeline header */
.timelineTop{ padding: 6px 8px !important; }
.timelineTop .muted{ font-size: 11px !important; }


/* === Fit-players mode: try to show more player columns without horizontal scroll === */
.timelineWrap table{
  table-layout: fixed !important; /* force columns to share space */
  width: 100% !important;
}
.timelineWrap th, .timelineWrap td{
  overflow: hidden !important;
}
.timeCol{ width: 64px !important; }

/* player columns: allow shrink */
.timelineWrap th.playerHead{
  font-size: 12px !important;
  padding: 4px 6px !important;
  white-space: nowrap !important;
  text-overflow: ellipsis !important;
  overflow: hidden !important;
}
.timelineWrap td.playerCol{
  padding: 3px 6px !important;
}

/* cards must shrink to column width */
.card{
  max-width: none !important;
  width: 100% !important;
  padding: 5px 6px !important;
}
.card h4{ font-size: 13px !important; }
.badge{ font-size: 10px !important; padding: 1px 5px !important; }

/* fallback when markup has no classes */
.timelineWrap thead th:not(.timeCol){
  font-size: 12px !important;
  padding: 4px 6px !important;
  white-space: nowrap !important;
  text-overflow: ellipsis !important;
  overflow: hidden !important;
}
.timelineWrap tbody td:not(.timeCol):not(.timeCell){
  padding: 3px 6px !important;
}


/* === Dark cards (black background + white text) === */
.card{
  background: #0b0f14 !important;
  color: #f3f4f6 !important;
  border-color: rgba(255,255,255,.10) !important;
  box-shadow: none !important;
}
.card h4{ color: #ffffff !important; }
.badge{
  background: rgba(255,255,255,.08) !important;
  border-color: rgba(255,255,255,.14) !important;
  color: #e5e7eb !important;
}
.badge.small{
  background: rgba(255,255,255,.06) !important;
  border-color: rgba(255,255,255,.12) !important;
  color: #d1d5db !important;
}
/* keep category color hint as a subtle left stripe */
.card{
  position: relative !important;
}
.card::before{
  content:"";
  position:absolute;
  left:0; top:0; bottom:0;
  width:3px;
  background: currentColor;
  opacity: .35;
  border-top-left-radius: inherit;
  border-bottom-left-radius: inherit;
}


/* === Inline Betaguide preview (no iframes) === */
.bgPreview{
  margin-top: 8px;
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px solid rgba(15,23,42,.12);
  background: rgba(255,255,255,.78);
  color: rgba(15,23,42,.92);
  display:none;
}
.bgPreview.on{ display:block; }
.bgPreviewTop{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
.bgPreviewLeft{ display:flex; align-items:center; gap:10px; min-width:0; }
.bgPreviewTitle{ font-weight:900; font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.bgPreviewSub{ font-size:12px; color:rgba(15,23,42,.68); margin-top:2px; }
.bgPreviewText{ min-width:0; }
.bgIcon{
  width:34px; height:34px;
  border-radius: 12px;
  display:flex; align-items:center; justify-content:center;
  border:1px solid rgba(15,23,42,.12);
  background: rgba(2,132,199,.08);
  flex: 0 0 auto;
}
.bgPreviewBtns{ display:flex; gap:8px; flex:0 0 auto; }
.bgLinkBtn{
  border-radius: 999px;
  padding: 7px 10px;
  border: 1px solid rgba(15,23,42,.16);
  background: rgba(15,23,42,.05);
  color: inherit;
  text-decoration:none;
  font-size: 12px;
  font-weight: 700;
  white-space:nowrap;
}
.bgLinkBtn:hover{ background: rgba(15,23,42,.10); }
.bgMiniClose{
  border-radius: 999px;
  padding: 7px 10px;
  border: 1px solid rgba(15,23,42,.16);
  background: rgba(255,255,255,.65);
  color: inherit;
  cursor:pointer;
  font-size: 12px;
  font-weight: 800;
}

</style>
</head>
<body>
  <header class="topbar">
    <div class="brand">Warzone 2100 Autohoster</div>
    <nav class="nav">
      <a class="navlink" href="./">Home</a>
      <a class="navlink" href="./games.html">Games</a>
      <a class="navlink active" href="./game-players.html" id="navPlayers">Results</a>
      <a class="navlink" href="./lobby.html">Lobby</a>
      <a class="navlink" href="./top.html">Leaderboard</a>
      <a class="navlink" href="./about.html">About</a>
      <a class="navlink" href="./rules.html">Rules</a>
    </nav>
  </header>

  <main class="wrap">
    <section class="page">
      <h1>Research Timeline</h1>
      <p class="muted">
        Light theme (wife-approved ðŸ˜„). Built from your existing
        <span class="pill">/jsons/matchstats.json</span>.
        No dropdown â€” you <b>search games</b> and click one to load.
      </p>

      <div class="card controls" style="margin:12px 0">
        <button id="btnRefresh">Refresh</button>
        <span class="muted" id="status">Loadingâ€¦</span>
        <span style="flex:1"></span>

        <label class="muted">Scope</label>
        <select id="scope">
          <option value="all">All time</option>
          <option value="30">Last 30 days</option>
          <option value="7">Last 7 days</option>
        </select>

        <label class="muted">Group</label>
        <select id="bucket">
          <option value="10" selected>10s</option>
          <option value="15">15s</option>
          <option value="30">30s</option>
          <option value="60">60s</option>
        </select>

        <label class="muted">Search games</label>
        <input id="gameQ" placeholder="map / name / id â€¦ e.g. ClassicNTW2" style="min-width:280px" />

        <label class="muted">Search events</label>
        <input id="q" placeholder="tech id or player" style="min-width:220px" />
      </div>

      <div class="split">
        <div class="card">
          <div class="kpis">
            <div class="kpi"><div class="big" id="kEvents">â€”</div><div class="lab">events</div></div>
            <div class="kpi"><div class="big" id="kPlayers">â€”</div><div class="lab">players</div></div>
            <div class="kpi"><div class="big" id="kDur">â€”</div><div class="lab">duration</div></div>
          </div>

          <div class="muted" style="margin-top:10px">
            <div>â€¢ Click a game below to load it</div>
            <div>â€¢ Sticky time + player headers</div>
            <div>â€¢ Search highlights matching cards</div>
          </div>

          <div class="legend" id="legend" style="margin-top:12px"></div>

          <div class="results" id="gamesList"></div>
        </div>

        <div class="timelineWrap">
          <div class="timelineTop">
            <div class="muted small" id="gameMeta">Pick a game on the leftâ€¦</div>
            <div class="muted small">Scroll â†” players â€¢ â†• time</div>
          </div>
          <div class="tableWrap">
            <table id="tbl">
              <thead><tr id="hdr"><th>Time</th></tr></thead>
              <tbody id="body"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div id="tip" class="tip"></div>
  <script src="./js/research-icons-map.js?v=20260109"></script>
  <script src="./js/research-timeline.js?v=20260109"></script>

<script>
(function(){
  try{
    const gid = new URLSearchParams(window.location.search).get('gid');
    if(!gid) return;
    const a = document.getElementById('navPlayers');
    if(a) a.href = './game-players.html?gid=' + encodeURIComponent(gid);
  }catch(e){}
})();
</script>

<!-- Matomo -->
<script>
  (function() {
    if (/github\.io$/i.test(window.location.hostname)) {
      return;
    }
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="/matomo/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  })();
</script>
<!-- End Matomo Code -->

</body>
</html>
