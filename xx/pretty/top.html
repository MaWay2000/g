<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Elo ratings — Warzone 2100 Autohoster</title>
  <link rel="stylesheet" href="./css/style.css" />
  <style>
    body{ background:#f6f7fb; }
    .wrap{ max-width: 1180px; padding: 18px 18px 44px; }
    .box{ background:#fff; border:1px solid var(--line); border-radius: 16px; box-shadow: 0 10px 30px rgba(17,24,39,.08); overflow:hidden; }
    .hero{ display:flex; align-items:flex-end; justify-content:space-between; gap:16px; padding: 18px 18px 10px; }
    h1{ font-size: 42px; line-height:1; margin: 6px 0; }
    .sub{ color: var(--muted); margin-top: 6px; }
    .toolbar{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; padding: 12px 18px 18px; }
    .pill{ display:inline-flex; align-items:center; gap:8px; padding: 7px 10px; border-radius: 999px; background:#f3f4f6; border: 1px solid var(--line); color:#374151; font-size: 13px; white-space:nowrap; }
    .btn{ border:1px solid var(--line); background:#fff; border-radius: 12px; padding: 10px 14px; font-weight:600; cursor:pointer; }
    .btn.primary{ background: var(--accent); color:#fff; border-color: var(--accent2); }
    .btn.primary:hover{ background: var(--accent2); }
    .input{ flex: 1 1 260px; min-width: 220px; border:1px solid var(--line); border-radius: 12px; padding: 10px 12px; font-size: 15px; background: #fff; }
    .num{ width: 120px; border:1px solid var(--line); border-radius: 12px; padding: 10px 12px; font-size: 15px; background:#fff; }
    table{ width:100%; border-collapse: separate; border-spacing: 0; }
    thead th{
      text-align:left; font-size: 12px; letter-spacing: .08em; text-transform: uppercase;
      color: #6b7280; padding: 12px 14px; border-bottom: 1px solid var(--line);
      background: #fbfbfe; position: sticky; top: 0; z-index: 2;
    }
    tbody td{ padding: 12px 14px; border-bottom: 1px solid var(--line); vertical-align: top; }
    tbody tr:hover{ background:#fafbff; }
    .name{ font-weight: 800; color: var(--accent); cursor:pointer; }
    .muted{ color: var(--muted); }
    .mono{ font-family: var(--mono); }
    .tag{
      display:inline-flex; padding: 2px 8px; border-radius: 999px;
      background:#eef2ff; color:#3730a3; border:1px solid #e0e7ff;
      font-size: 12px; font-weight: 700;
    }
    .a{
      display:inline-flex; align-items:center; gap:6px; padding: 7px 10px;
      border: 1px solid var(--line); border-radius: 999px; background:#fff;
      color:#111827; text-decoration:none; font-weight: 600; font-size: 13px;
    }
    .a:hover{ background:#f3f4ff; text-decoration:none; }
    .modalBack{
      position: fixed; inset: 0; background: rgba(17,24,39,.48);
      display:none; align-items:center; justify-content:center; z-index: 50; padding: 18px;
    }
    .modal{
      width: min(980px, 96vw); max-height: min(820px, 90vh); overflow: auto;
      background:#fff; border-radius: 18px; border: 1px solid rgba(255,255,255,.4);
      box-shadow: 0 30px 80px rgba(0,0,0,.25);
    }
    .modalHead{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding: 14px 16px; border-bottom: 1px solid var(--line);
      position: sticky; top:0; background:#fff; z-index: 2;
    }
    .close{ border:1px solid var(--line); background:#fff; border-radius: 12px; padding: 8px 10px; cursor:pointer; font-weight: 800; }
    .links{ display:flex; flex-wrap:wrap; gap:8px; margin-top: 10px; }
    .pills{ display:flex; flex-wrap:wrap; gap:8px; }
    .deltaUp{ color:#166534; font-weight:800; }
    .deltaDown{ color:#991b1b; font-weight:800; }
  </style>
</head>
<body>
  <header class="topbar">
  <div class="brand"><img class="brand__image" src="./img/ban.png" alt="Warzone 2100 Autohoster" loading="eager" decoding="async" /></div>
  <nav class="nav">
    <a class="navlink" data-nav="home" href="./">Home</a>
    <a class="navlink" data-nav="games" href="./games.html">Games</a>
    <a class="navlink" data-nav="players" href="./players.html">Players</a>
    <a class="navlink" data-nav="lobby" href="./lobby.html">Lobby</a>
    <a class="navlink" data-nav="leaderboard" href="./top.html">Leaderboard</a>
  </nav>
</header>

  <main class="wrap">
    <section class="box">
      <div class="hero">
        <div>
          <h1>Elo ratings</h1>
          <div class="sub">Computed from <span class="mono">Matchstats (team Elo, K=32). Click a player for details + replay links.</div>
        </div>
        <div id="status" class="pill">Idle</div>
      </div>

      <div class="toolbar">
        <button class="btn primary" id="btnRefresh">Refresh</button>
        <input class="input" id="q" placeholder="Search player / public hash…" />
        <span class="pill">Min games <input class="num" id="minGames" type="number" min="0" step="1" value="3" /></span>
        <span class="pill"><strong id="kPlayers">0</strong> players</span>
        <span class="pill"><strong id="kGames">0</strong> games</span>
        <span class="pill">Last <strong id="kLast">—</strong></span>
      </div>

      <div style="max-height: 700px; overflow:auto;">
        <table aria-label="Elo leaderboard">
          <thead>
            <tr>
              <th style="width:6%;">#</th>
              <th style="width:22%;">Player</th>
              <th style="width:10%;">Elo</th>
              <th style="width:10%;">Games</th>
              <th style="width:14%;">W-L-D</th>
              <th style="width:10%;">Win%</th>
              <th style="width:20%;">Player id (public hash)</th>
              <th style="width:18%;">Last seen (UTC)</th>
            </tr>
          </thead>
          <tbody id="tbody">
            <tr><td colspan="8" class="muted" style="padding:14px;">Loading…</td></tr>
          </tbody>
        </table>
      </div>

      <div class="footer muted small">
        Replay links come from each match's <span class="mono">replay_url</span>/<span class="mono">replay_file</span>. Player ids come from <span class="mono">publicKey</span> in matchstats.
      </div>
    </section>
  </main>

  <div class="modalBack" id="modalBack" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <div class="modalHead">
        <div>
          <div id="modalTitle" style="font-size:18px; font-weight:900;">Player</div>
          <div id="modalSub" class="muted" style="font-size:13px;">—</div>
        </div>
        <button class="close" id="btnClose">✕</button>
      </div>
      <div style="padding: 12px 14px 16px;">
        <div id="modalPills" class="pills"></div>
        <div id="modalLinks" class="links"></div>
        <div style="height:10px;"></div>
        <table style="width:100%;">
          <thead>
            <tr>
              <th style="width:18%;">When (UTC)</th>
              <th style="width:18%;">Map</th>
              <th style="width:8%;">R</th>
              <th style="width:14%;">Elo Δ</th>
              <th>Replay / Open</th>
            </tr>
          </thead>
          <tbody id="modalBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <script type="module" src="./js/elo-leaderboard.js"></script>
  <script src="./js/nav-active.js"></script>

<!-- Matomo -->
<script>
  (function() {
    if (/github\.io$/i.test(window.location.hostname)) {
      return;
    }
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="/matomo/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  })();
</script>
<!-- End Matomo Code -->

</body>
</html>
