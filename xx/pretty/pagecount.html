<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WZ-2100 — Traffic & Visitor Journeys</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --bg: #0b1020;
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.09);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --line: rgba(255,255,255,.12);
      --shadow: 0 20px 50px rgba(0,0,0,.35);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 600px at 15% 10%, rgba(99,102,241,.25), transparent 60%),
        radial-gradient(1000px 600px at 90% 20%, rgba(16,185,129,.18), transparent 55%),
        radial-gradient(900px 500px at 60% 95%, rgba(236,72,153,.16), transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
    }
    .wrap{max-width:1200px;margin:0 auto;padding:24px}
    .top{
      display:flex; gap:14px; align-items:flex-start; justify-content:space-between;
      margin:10px 0 18px;
    }
    .title{
      display:flex; flex-direction:column; gap:6px;
    }
    h1{font-size:22px;margin:0;letter-spacing:.2px}
    .sub{color:var(--muted);font-size:13px;line-height:1.4}
    .pillrow{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
    .pill{
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      padding:8px 10px;
      border-radius:999px;
      font-size:12px;
      color:var(--muted);
      display:inline-flex; gap:8px; align-items:center;
    }
    .pill strong{color:var(--text);font-weight:600}
    .actions{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
    }
    .btn{
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      color:var(--text);
      padding:10px 12px;
      border-radius:12px;
      font-size:13px;
      cursor:pointer;
      text-decoration:none;
      display:inline-flex; align-items:center; gap:8px;
      box-shadow: 0 8px 18px rgba(0,0,0,.25);
    }
    .btn:hover{background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06))}
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap:14px;
    }
    .card{
      grid-column: span 12;
      background:linear-gradient(180deg, var(--card), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .cardhead{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 14px 10px 14px;
      border-bottom:1px solid var(--line);
      background:rgba(0,0,0,.10);
    }
    .cardhead .h{
      display:flex; flex-direction:column; gap:3px;
    }
    .cardhead h2{
      margin:0; font-size:14px; font-weight:650; letter-spacing:.2px;
    }
    .cardhead p{
      margin:0; font-size:12px; color:var(--muted);
    }
    .cardbody{padding:0}
    iframe{
      width:100%;
      height:560px;
      border:0;
      display:block;
      background:rgba(0,0,0,.12);
    }
    .split iframe{height:520px}
    .card.small iframe{height:420px}

    @media (min-width: 900px){
      .card.w6{grid-column: span 6}
      .card.w7{grid-column: span 7}
      .card.w5{grid-column: span 5}
      .card.w8{grid-column: span 8}
      iframe{height:540px}
      .card.small iframe{height:420px}
    }

    .notice{
      margin-top:14px;
      color:var(--muted);
      font-size:12px;
      line-height:1.45;
      border:1px dashed rgba(255,255,255,.18);
      padding:12px 14px;
      border-radius:14px;
      background:rgba(255,255,255,.03);
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      padding:2px 6px; border-radius:8px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      font-size:12px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div class="title">
        <h1>WZ-2100 Traffic — IPs, Locations, Pages Visited</h1>
        <div class="sub">
          This page is a curated dashboard that embeds Matomo “Widgetize” reports (iframes).
          Copy widget URLs from Matomo → <span class="kbd">Administration → Platform → Widgets</span> and paste them into the config below.
        </div>
        <div class="pillrow">
          <div class="pill">Status: <strong id="status">Not configured</strong></div>
          <div class="pill">Updated: <strong id="updated">—</strong></div>
          <div class="pill">Site: <strong id="site">—</strong></div>
        </div>
      </div>

      <div class="actions">
        <a class="btn" id="openMatomo" href="/matomo/" target="_blank" rel="noreferrer">Open Matomo</a>
        <a class="btn" id="openVisitorLog" href="#" target="_blank" rel="noreferrer">Open Visitor Log</a>
        <a class="btn" href="javascript:location.reload()">Refresh</a>
      </div>
    </div>

    <div class="grid" id="cards"></div>

    <div class="notice">
      <strong>Security / privacy reminder:</strong> if you’re showing IP addresses and locations, keep <span class="kbd">/pretty/</span> behind authentication
      and set a sensible retention policy. In the UK/EU, IP addresses are personal data.
    </div>
  </div>

<script>
/**
 * CONFIGURE ME
 * 1) In Matomo: Administration → Platform → Widgets
 * 2) Under “Widgetize reports”, copy the iFrame URL for each report you want.
 * 3) Paste into WIDGETS below.
 *
 * Tip: Use a dedicated “view-only” Matomo user for embeds and protect /pretty with Caddy basicauth.
 */

const SITE_LABEL = "wz-2100.com";
const VISITOR_LOG_URL = "/matomo/index.php?module=CoreHome&action=index&idSite=1&period=day&date=today#?category=General_Visitors&subcategory=Live_Visitors";

// Add / replace these with actual Widgetize iframe URLs copied from Matomo Widgets page.
// Example format (from Matomo docs/issues): /matomo/index.php?module=Widgetize&action=iframe&moduleToWidgetize=CoreHome&actionToWidgetize=index&idSite=62&period=week&date=yesterday
const WIDGETS = [
  {
    title: "Visitor Log (IPs → pages visited)",
    desc: "See each visit, IP address, location, and clickstream (best for “who did what”).",
    url: "", // <-- paste Widgetize URL for Visitor Log / Live / Visits Log
    width: "w12",
    heightClass: ""
  },
  {
    title: "Top Pages",
    desc: "Most viewed URLs and entry/exit pages.",
    url: "", // <-- paste Widgetize URL for Actions → Pages
    width: "w6",
    heightClass: "small"
  },
  {
    title: "Referrers",
    desc: "Where visitors came from (search, direct, websites, campaigns).",
    url: "", // <-- paste Widgetize URL for Referrers overview
    width: "w6",
    heightClass: "small"
  },
  {
    title: "Locations",
    desc: "Countries/regions/cities of visitors (GeoIP recommended).",
    url: "", // <-- paste Widgetize URL for Visitors → Locations
    width: "w6",
    heightClass: "small"
  },
  {
    title: "Devices / Browsers",
    desc: "Devices, OS, browsers (helpful for debugging + product decisions).",
    url: "", // <-- paste Widgetize URL for Devices/Software
    width: "w6",
    heightClass: "small"
  }
];

function el(tag, attrs={}, children=[]) {
  const n = document.createElement(tag);
  Object.entries(attrs).forEach(([k,v]) => {
    if (k === "class") n.className = v;
    else if (k === "html") n.innerHTML = v;
    else n.setAttribute(k, v);
  });
  children.forEach(c => n.appendChild(c));
  return n;
}

function build() {
  document.getElementById("updated").textContent = new Date().toLocaleString();
  document.getElementById("site").textContent = SITE_LABEL;
  document.getElementById("openVisitorLog").href = VISITOR_LOG_URL;

  const cards = document.getElementById("cards");
  cards.innerHTML = "";

  const configured = WIDGETS.some(w => (w.url || "").trim().length > 0);
  document.getElementById("status").textContent = configured ? "Configured" : "Paste widget URLs";
  document.getElementById("status").style.opacity = configured ? "1" : ".85";

  WIDGETS.forEach(w => {
    const hasUrl = (w.url || "").trim().length > 0;

    const head = el("div", {class:"cardhead"}, [
      el("div", {class:"h"}, [
        el("h2", {html: w.title}),
        el("p", {html: w.desc})
      ]),
      el("div", {}, [
        el("a", {
          class:"btn",
          href: hasUrl ? w.url : "/matomo/",
          target:"_blank",
          rel:"noreferrer",
          html: hasUrl ? "Open widget" : "Get widget URL"
        })
      ])
    ]);

    const iframe = el("iframe", {
      src: hasUrl ? w.url : "about:blank",
      loading: "lazy",
      referrerpolicy: "no-referrer"
    });

    const body = el("div", {class:"cardbody"}, [iframe]);

    const card = el("div", {class:`card ${w.width || "w12"} ${w.heightClass || ""}`}, [head, body]);
    cards.appendChild(card);

    if (!hasUrl) {
      iframe.style.height = "160px";
      iframe.style.background = "rgba(255,255,255,.03)";
      iframe.srcdoc = `
        <div style="font:14px system-ui; color:rgba(255,255,255,.75); padding:18px;">
          <b>Not configured yet.</b><br/>
          Open Matomo → Administration → Platform → Widgets → copy an iFrame URL for:
          <div style="margin-top:10px; padding:10px; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12); border-radius:12px;">
            ${w.title}
          </div>
        </div>`;
    }
  });
}

build();
</script>

<!-- Matomo -->
<script>
  (function() {
    if (/github\.io$/i.test(window.location.hostname)) {
      return;
    }
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="/matomo/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  })();
</script>
<!-- End Matomo Code -->

</body>
</html>
