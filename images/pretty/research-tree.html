<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Warzone 2100 Autohoster — Research Tree</title>
  <link rel="stylesheet" href="./css/style.css" />
  <link rel="stylesheet" href="./css/research-tree.css" />
  <style>
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    select,input{background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.16);color:inherit;border-radius:10px;padding:8px 10px}
    button{border-radius:10px;padding:8px 10px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.06);color:inherit;cursor:pointer}
    button:hover{background:rgba(255,255,255,.10)}
    .muted{opacity:.75}
    .pill{display:inline-block;padding:3px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.18);opacity:.9;font-size:12px}
    .grid{display:grid;gap:12px;grid-template-columns:repeat(12,1fr)}
    .card{grid-column:span 12;background:rgba(255,255,255,.03);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:14px}
    @media(min-width:980px){ .third{grid-column:span 4} .twoThird{grid-column:span 8} }
    #vizWrap{height:72vh; min-height:520px}
    #viz{width:100%;height:100%;border-radius:14px;border:1px solid rgba(255,255,255,.08);background:rgba(0,0,0,.15)}
    .kpi{display:flex;gap:10px;align-items:baseline;flex-wrap:wrap}
    .kpi .big{font-size:28px;font-weight:800;letter-spacing:.2px}
    .kpi .label{opacity:.8}
    .legend{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .legitem{display:flex;gap:6px;align-items:center}
    .dot{width:10px;height:10px;border-radius:50%}
    .tip{position:fixed;pointer-events:none;z-index:9999;background:rgba(15,18,26,.95);border:1px solid rgba(255,255,255,.14);color:#fff;padding:10px 12px;border-radius:12px;max-width:320px;display:none}
    .small{font-size:12px}
    code{background:rgba(0,0,0,.25);padding:2px 6px;border-radius:8px}
  </style>

  <!-- D3 (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/d3@7/dist/d3.min.js"></script>
</head>
<body>
  <header class="topbar">
  <div class="brand">Warzone 2100 Autohoster</div>
  <nav class="nav">
    <a class="navlink" data-nav="home" href="./">Home</a>
    <a class="navlink" data-nav="games" href="./games.html">Games</a>
    <a class="navlink" data-nav="players" href="./players.html">Players</a>
    <a class="navlink" data-nav="lobby" href="./lobby.html">Lobby</a>
    <a class="navlink" data-nav="leaderboard" href="./top.html">Leaderboard</a>
  </nav>
</header>

  <main class="wrap">
    <section class="page">
      <h1>Research Tree (Observed)</h1>
      <p class="muted">
        This is an <b>observed</b> tree/graph built from your existing
        <span class="pill">/jsons/matchstats.json</span>.
        It infers edges when a player completes tech <b>B</b> after tech <b>A</b> in the same game.
        Think “what people actually research next”, not the official WZ dependency graph.
      </p>

      <div class="controls card" style="margin:12px 0">
        <button id="btnRefresh">Build / Refresh</button>
        <span class="muted" id="status">Loading…</span>
        <span style="flex:1"></span>

        <label class="muted">Scope</label>
        <select id="scope">
          <option value="all">All time</option>
          <option value="30">Last 30 days</option>
          <option value="7">Last 7 days</option>
        </select>

        <label class="muted">Player</label>
        <select id="playerPick">
          <option value="">All players</option>
        </select>

        <label class="muted">Edge min</label>
        <select id="edgeMin">
          <option value="1">1</option>
          <option value="2" selected>2</option>
          <option value="5">5</option>
          <option value="10">10</option>
        </select>

        <label class="muted">Top nodes</label>
        <select id="topN">
          <option value="80">80</option>
          <option value="120" selected>120</option>
          <option value="200">200</option>
          <option value="400">400</option>
        </select>

        <label class="muted">Search tech</label>
        <input id="q" placeholder="e.g. R-Wpn-MG1Mk1" style="min-width:240px" />
      </div>

      <div class="grid">
        <div class="card third">
          <div class="kpi"><span class="big" id="kGames">—</span><span class="label">games</span></div>
          <div class="kpi"><span class="big" id="kPlayers">—</span><span class="label">players</span></div>
          <div class="kpi"><span class="big" id="kNodes">—</span><span class="label">nodes</span></div>
          <div class="kpi"><span class="big" id="kEdges">—</span><span class="label">edges</span></div>
          <div class="muted small" style="margin-top:10px">
            <div><b>Node size</b> = completion count</div>
            <div><b>Edge width</b> = “A → B” frequency</div>
            <div class="small">Tip: scroll to zoom, drag to pan, drag nodes.</div>
          </div>
          <div class="legend" id="legend"></div>
        </div>

        <div class="card twoThird" id="vizWrap">
          <svg id="viz"></svg>
        </div>
      </div>

      <p class="muted small" style="margin-top:12px">
        If you ever add the official tech dependency data later, we can upgrade this into a real WZ research DAG.
      </p>
    </section>
  </main>

  <div id="tip" class="tip"></div>
  <script src="./js/research-tree.js"></script>
  <script src="./js/nav-active.js"></script>

<!-- Matomo -->
<script>
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="/matomo/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Matomo Code -->

</body>
</html>
