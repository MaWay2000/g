<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Map Maker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: light dark;
        --slate-950: #020617;
        --slate-900: #0f172a;
        --slate-800: #1e293b;
        --slate-700: #334155;
        --slate-600: #475569;
        --slate-500: #64748b;
        --slate-200: #e2e8f0;
        --sky-300: #7dd3fc;
        --green-400: #34d399;
        --amber-400: #fbbf24;
        --red-400: #f87171;
        --cell-size: 42px;
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, var(--slate-800), var(--slate-950) 70%);
        color: var(--slate-200);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        height: 100vh;
        min-height: 100vh;
        display: grid;
        grid-template-columns: minmax(320px, 360px) minmax(0, 1fr);
        grid-template-rows: auto minmax(0, 1fr);
        grid-template-areas:
          "header header"
          "sidebar main";
        gap: 0;
        background: transparent;
        overflow: hidden;
      }

      header {
        grid-area: header;
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1.25rem 1.75rem;
        border-bottom: 1px solid rgba(148, 163, 184, 0.25);
        background: linear-gradient(
          180deg,
          rgba(15, 23, 42, 0.92),
          rgba(15, 23, 42, 0.65)
        );
        backdrop-filter: blur(18px);
      }

      header h1 {
        margin: 0;
        font-size: 1.4rem;
        font-weight: 700;
        letter-spacing: 0.03em;
      }

      .header-actions {
        margin-left: auto;
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
      }

      .map-maker-tabs {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.25rem;
        border-radius: 0.45rem;
        border: 1px solid rgba(71, 85, 105, 0.9);
        background: linear-gradient(180deg, #0f172a, #111827 70%);
        box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.8);
      }

      .map-maker-update {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.3rem 0.6rem;
        border-radius: 0.45rem;
        border: 1px solid rgba(71, 85, 105, 0.6);
        background: rgba(15, 23, 42, 0.35);
        color: rgba(226, 232, 240, 0.75);
        font-size: 0.75rem;
        letter-spacing: 0.02em;
      }

      .map-maker-tab {
        border: 1px solid rgba(51, 65, 85, 0.9);
        background: #1e293b;
        color: #e2e8f0;
        font-size: 0.78rem;
        font-weight: 600;
        letter-spacing: 0.01em;
        text-transform: none;
        padding: 0.35rem 0.7rem;
        border-radius: 0.35rem;
        cursor: pointer;
        transition: transform 140ms ease, border-color 140ms ease,
          background 140ms ease, color 140ms ease;
      }

      .map-maker-tab:hover,
      .map-maker-tab:focus-visible {
        transform: translateY(-1px);
        border-color: rgba(148, 163, 184, 0.8);
        background: linear-gradient(180deg, #243447, #18202f);
        outline: none;
      }

      .map-maker-tab.is-active {
        border-color: #1f2937;
        background: linear-gradient(180deg, #7dff3a, #6ff216);
        color: #0b1120;
        box-shadow: inset 0 0 0 1px rgba(22, 163, 74, 0.4);
      }

      .map-maker-tab:disabled {
        opacity: 0.55;
        cursor: not-allowed;
        transform: none;
      }

      .map-maker-tab:disabled:hover,
      .map-maker-tab:disabled:focus-visible {
        border-color: rgba(51, 65, 85, 0.9);
        background: #1e293b;
        color: #e2e8f0;
      }

      .header-actions button,
      .header-actions a {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.55rem 0.95rem;
        border-radius: 0.75rem;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: rgba(15, 23, 42, 0.6);
        color: inherit;
        font-size: 0.85rem;
        font-weight: 600;
        letter-spacing: 0.05em;
        text-decoration: none;
        cursor: pointer;
        transition: transform 160ms ease, border-color 160ms ease,
          background 160ms ease;
      }

      .header-actions button:hover,
      .header-actions button:focus-visible,
      .header-actions a:hover,
      .header-actions a:focus-visible {
        transform: translateY(-1px);
        border-color: rgba(148, 163, 184, 0.6);
        background: rgba(56, 189, 248, 0.2);
      }

      .sidebar {
        grid-area: sidebar;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        padding: 0.75rem 1.25rem 1.5rem;
        border-right: 1px solid rgba(148, 163, 184, 0.2);
        background: linear-gradient(180deg, rgba(15, 23, 42, 0.78), rgba(2, 6, 23, 0.7));
        box-shadow: inset -1px 0 0 rgba(148, 163, 184, 0.08),
          inset 0 1px 0 rgba(255, 255, 255, 0.04);
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: rgba(148, 163, 184, 0.5) rgba(15, 23, 42, 0.55);
      }

      .sidebar::-webkit-scrollbar {
        width: 10px;
      }

      .sidebar::-webkit-scrollbar-track {
        background: rgba(15, 23, 42, 0.55);
      }

      .sidebar::-webkit-scrollbar-thumb {
        border-radius: 999px;
        border: 2px solid rgba(15, 23, 42, 0.8);
        background: rgba(148, 163, 184, 0.4);
      }

      .sidebar::-webkit-scrollbar-thumb:hover {
        background: rgba(148, 163, 184, 0.6);
      }

      .sidebar-section {
        padding: 1rem 1.1rem 1.25rem;
        border: 1px solid rgba(148, 163, 184, 0.15);
        background: rgba(15, 23, 42, 0.35);
        box-shadow: inset 0 0 0 1px rgba(2, 6, 23, 0.6);
      }

      .sidebar-section h2 {
        margin: 0 0 0.65rem;
        font-size: 0.85rem;
        font-weight: 700;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: rgba(226, 232, 240, 0.86);
      }

      .sidebar-section p {
        margin: 0 0 0.75rem;
        font-size: 0.85rem;
        line-height: 1.6;
        color: rgba(226, 232, 240, 0.72);
      }

      .door-list-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 0.75rem;
        font-size: 0.78rem;
        font-weight: 600;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: rgba(226, 232, 240, 0.65);
      }

      .door-list-count {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 1.6rem;
        padding: 0.1rem 0.45rem;
        border-radius: 999px;
        background: rgba(59, 130, 246, 0.25);
        color: rgba(226, 232, 240, 0.92);
        font-size: 0.75rem;
      }

      .door-list-empty {
        margin: 0.45rem 0 0;
        font-size: 0.8rem;
        color: rgba(226, 232, 240, 0.6);
      }

      .door-list {
        margin: 0.6rem 0 0;
        padding: 0;
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: 0.55rem;
      }

      .door-list-item {
        padding: 0.55rem 0.65rem;
        border-radius: 0.65rem;
        border: 1px solid rgba(148, 163, 184, 0.18);
        background: rgba(15, 23, 42, 0.55);
        box-shadow: inset 0 0 0 1px rgba(2, 6, 23, 0.55);
      }

      .door-list-item-head {
        display: flex;
        align-items: flex-start;
        gap: 0.5rem;
      }

      .door-list-item-title {
        flex: 1;
        min-width: 0;
      }

      .door-list-focus {
        flex: 1;
        text-align: left;
        border: none;
        background: transparent;
        color: inherit;
        cursor: pointer;
        padding: 0;
      }

      .door-list-name {
        font-size: 0.85rem;
        font-weight: 600;
        color: rgba(226, 232, 240, 0.9);
      }

      .door-list-id {
        margin-top: 0.2rem;
        font-size: 0.75rem;
        color: rgba(226, 232, 240, 0.6);
      }

      .door-list-destination {
        margin-top: 0.45rem;
        display: grid;
        gap: 0.35rem;
      }

      .door-destination-label {
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.04em;
        color: rgba(226, 232, 240, 0.65);
      }

      .door-destination-select {
        width: 100%;
        padding: 0.45rem 0.6rem;
        border-radius: 0.55rem;
        border: 1px solid rgba(148, 163, 184, 0.25);
        background: rgba(2, 6, 23, 0.55);
        color: inherit;
        font-size: 0.8rem;
      }

      .door-destination-select:focus-visible {
        outline: none;
        border-color: rgba(56, 189, 248, 0.7);
        box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.2);
      }

      .door-list-remove {
        padding: 0.08rem 0.55rem;
        line-height: 1.1;
        border-radius: 0.45rem;
      }

      .object-list-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 0.75rem;
        font-size: 0.78rem;
        font-weight: 600;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: rgba(226, 232, 240, 0.65);
      }

      .object-list-count {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 1.6rem;
        padding: 0.1rem 0.45rem;
        border-radius: 999px;
        background: rgba(16, 185, 129, 0.2);
        color: rgba(226, 232, 240, 0.92);
        font-size: 0.75rem;
      }

      .object-list-empty {
        margin: 0.45rem 0 0;
        font-size: 0.8rem;
        color: rgba(226, 232, 240, 0.6);
      }

      .object-list {
        margin: 0.6rem 0 0;
        padding: 0;
        list-style: none;
        display: flex;
        flex-direction: column;
        gap: 0.55rem;
      }

      .object-list-item {
        display: flex;
        align-items: stretch;
        gap: 0.5rem;
        padding: 0.5rem;
        border-radius: 0.65rem;
        border: 1px solid rgba(148, 163, 184, 0.18);
        background: rgba(15, 23, 42, 0.55);
        box-shadow: inset 0 0 0 1px rgba(2, 6, 23, 0.55);
      }

      .object-list-focus {
        flex: 1;
        text-align: left;
        border: none;
        background: transparent;
        color: inherit;
        cursor: pointer;
        padding: 0.25rem 0.35rem;
      }

      .object-list-focus:focus-visible {
        outline: none;
        box-shadow: 0 0 0 2px rgba(56, 189, 248, 0.35);
      }

      .object-list-name {
        display: block;
        font-size: 0.85rem;
        font-weight: 600;
        color: rgba(226, 232, 240, 0.9);
      }

      .object-list-id {
        display: block;
        margin-top: 0.15rem;
        font-size: 0.75rem;
        color: rgba(226, 232, 240, 0.6);
      }

      .object-list-rotation {
        color: rgba(125, 211, 252, 0.85);
      }

      .object-list-collision-status[data-active="true"] {
        color: rgba(74, 222, 128, 0.95);
      }

      .object-list-collision-status[data-active="false"] {
        color: rgba(248, 113, 113, 0.95);
      }

      .object-list-actions {
        display: inline-flex;
        align-items: stretch;
        gap: 0.35rem;
      }

      .object-list-rotate-column {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
      }

      .object-list-rotate,
      .object-list-collision,
      .object-list-remove {
        border: 1px solid rgba(248, 113, 113, 0.45);
        background: rgba(248, 113, 113, 0.16);
        color: rgba(248, 113, 113, 0.95);
        padding: 0 0.55rem;
        font-size: 0.9rem;
        font-weight: 700;
        cursor: pointer;
        transition: transform 120ms ease, background 120ms ease;
      }

      .object-list-rotate {
        min-width: 2.1rem;
      }

      .object-list-collision {
        min-width: 2.1rem;
      }

      .object-list-remove {
        min-width: 2.1rem;
      }

      .object-list-rotate {
        border-color: rgba(56, 189, 248, 0.4);
        background: rgba(56, 189, 248, 0.12);
        color: rgba(125, 211, 252, 0.95);
      }

      .object-list-rotate:hover,
      .object-list-rotate:focus-visible {
        transform: translateY(-1px);
        background: rgba(56, 189, 248, 0.22);
        outline: none;
      }

      .object-list-collision {
        border-color: rgba(74, 222, 128, 0.4);
        background: rgba(74, 222, 128, 0.12);
        color: rgba(134, 239, 172, 0.98);
      }

      .object-list-collision[data-active="false"] {
        border-color: rgba(148, 163, 184, 0.45);
        background: rgba(148, 163, 184, 0.14);
        color: rgba(203, 213, 225, 0.95);
      }

      .object-list-collision:hover,
      .object-list-collision:focus-visible {
        transform: translateY(-1px);
        background: rgba(74, 222, 128, 0.22);
        outline: none;
      }

      .object-list-collision[data-active="false"]:hover,
      .object-list-collision[data-active="false"]:focus-visible {
        background: rgba(148, 163, 184, 0.24);
      }

      .object-list-remove:hover,
      .object-list-remove:focus-visible {
        transform: translateY(-1px);
        background: rgba(248, 113, 113, 0.28);
        outline: none;
      }

      .control-group {
        display: grid;
        gap: 0.65rem;
      }

      .control {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
      }

      .control label {
        font-size: 0.8rem;
        font-weight: 600;
        color: rgba(226, 232, 240, 0.7);
      }

      .control input[type="number"],
      .control input[type="text"],
      .control textarea,
      .control select {
        padding: 0.55rem 0.65rem;
        border-radius: 0.65rem;
        border: 1px solid rgba(148, 163, 184, 0.3);
        background: rgba(2, 6, 23, 0.55);
        color: inherit;
        font-size: 0.85rem;
        transition: border-color 160ms ease, background 160ms ease;
      }

      .control textarea {
        min-height: 140px;
        resize: vertical;
      }

      .control input:focus-visible,
      .control textarea:focus-visible,
      .control select:focus-visible {
        outline: none;
        border-color: rgba(56, 189, 248, 0.6);
        background: rgba(15, 23, 42, 0.8);
      }

      .terrain-palette {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(64px, 1fr));
        gap: 0.45rem;
      }

      .objects-palette {
        display: grid;
        gap: 0.65rem;
      }

      .object-card {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
        padding: 0.55rem 0.7rem;
        border-radius: 0.65rem;
        border: 1px solid rgba(51, 65, 85, 0.9);
        background: rgba(2, 6, 23, 0.6);
        color: inherit;
        text-align: left;
        cursor: pointer;
        transition: transform 140ms ease, border-color 140ms ease,
          background 140ms ease;
      }

      .object-card:hover,
      .object-card:focus-visible {
        transform: translateY(-1px);
        border-color: rgba(56, 189, 248, 0.6);
        background: rgba(15, 23, 42, 0.75);
        outline: none;
      }

      .object-card[data-active="true"] {
        border-color: #1f2937;
        background: linear-gradient(180deg, #7dff3a, #6ff216);
        color: #0b1120;
        box-shadow: inset 0 0 0 1px rgba(22, 163, 74, 0.4);
      }

      .object-card-label {
        font-size: 0.85rem;
        font-weight: 600;
      }

      .object-card-path {
        font-size: 0.72rem;
        color: rgba(226, 232, 240, 0.7);
        word-break: break-all;
      }

      .object-card[data-active="true"] .object-card-path {
        color: rgba(15, 23, 42, 0.8);
      }

      .terrain-menu {
        display: grid;
        gap: 0.75rem;
        padding: 0;
        border-radius: 0;
        border: none;
        background: transparent;
      }

      .terrain-menu-actions {
        display: flex;
        flex-wrap: nowrap;
        gap: 0.5rem;
        width: 100%;
      }

      .terrain-mode-button {
        padding: 0.4rem 0.85rem;
        border-radius: 0.35rem;
        border: 1px solid rgba(51, 65, 85, 0.9);
        background: #1f2937;
        color: #e2e8f0;
        font-size: 0.78rem;
        font-weight: 600;
        letter-spacing: 0.02em;
        cursor: pointer;
        width: auto;
        text-align: center;
        white-space: nowrap;
        transition: transform 120ms ease, border-color 120ms ease,
          background 120ms ease;
      }

      .terrain-mode-button:hover,
      .terrain-mode-button:focus-visible {
        transform: translateY(-1px);
        border-color: rgba(148, 163, 184, 0.6);
        outline: none;
      }

      .terrain-mode-button.is-active,
      .terrain-mode-button[aria-pressed="true"] {
        border-color: #1f2937;
        background: linear-gradient(180deg, #7dff3a, #6ff216);
        color: #0b1120;
      }

      .terrain-control-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.6rem;
        align-items: center;
        justify-content: space-between;
      }

      .terrain-control-row[hidden] {
        display: none;
      }

      .terrain-rotation {
        display: inline-flex;
        align-items: center;
        gap: 0.45rem;
        font-size: 0.8rem;
      }

      .terrain-icon-button {
        width: 2rem;
        height: 2rem;
        border-radius: 0.55rem;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: rgba(30, 41, 59, 0.7);
        color: inherit;
        font-size: 0.9rem;
        cursor: pointer;
        transition: transform 120ms ease, border-color 120ms ease;
      }

      .terrain-icon-button:hover,
      .terrain-icon-button:focus-visible {
        transform: translateY(-1px);
        border-color: rgba(129, 140, 248, 0.6);
        outline: none;
      }

      .terrain-control-label {
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.05em;
        text-transform: uppercase;
        color: rgba(226, 232, 240, 0.7);
      }

      .terrain-tile-display {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        font-size: 0.8rem;
      }

      .terrain-brush-row {
        justify-content: flex-start;
        gap: 0.75rem;
      }

      .terrain-brush-size {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.8rem;
      }

      .terrain-brush-size input[type="range"] {
        accent-color: #38bdf8;
        width: 140px;
      }

      .height-value-control {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        flex: 1;
      }

      .height-value-control input[type="number"] {
        width: 4.25rem;
      }

      .height-value-control input[type="range"] {
        accent-color: #38bdf8;
        flex: 1;
        min-width: 140px;
      }

      .height-presets {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .terrain-draw-actions {
        display: flex;
        gap: 0.5rem;
        width: 100%;
        justify-content: center;
      }

      .terrain-action-button {
        padding: 0.45rem 0.9rem;
        border-radius: 0.55rem;
        border: 1px solid rgba(51, 65, 85, 0.9);
        background: rgba(30, 41, 59, 0.7);
        color: inherit;
        font-size: 0.78rem;
        font-weight: 600;
        letter-spacing: 0.03em;
        cursor: pointer;
        transition: transform 120ms ease, border-color 120ms ease,
          background 120ms ease, opacity 120ms ease;
      }

      .terrain-action-button:hover,
      .terrain-action-button:focus-visible {
        transform: translateY(-1px);
        border-color: rgba(148, 163, 184, 0.6);
        outline: none;
      }

      .terrain-action-button:disabled {
        opacity: 0.45;
        cursor: not-allowed;
      }

      .terrain-brush-value {
        min-width: 2.5rem;
        padding: 0.2rem 0.45rem;
        border-radius: 0.5rem;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: rgba(15, 23, 42, 0.7);
        text-align: center;
        font-size: 0.8rem;
        font-weight: 600;
        color: #e2e8f0;
      }

      .terrain-type-select {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        font-size: 0.8rem;
      }

      .terrain-selection-row {
        align-items: flex-start;
        gap: 0.85rem;
      }

      .terrain-selection-group {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
      }

      .terrain-type-select select {
        padding: 0.35rem 0.5rem;
        border-radius: 0.55rem;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: rgba(2, 6, 23, 0.65);
        color: inherit;
        font-size: 0.8rem;
      }

      .terrain-type-select select option {
        padding-left: 0.65rem;
        background-image: linear-gradient(
          var(--terrain-color, transparent),
          var(--terrain-color, transparent)
        );
        background-size: 0.75rem 0.75rem;
        background-repeat: no-repeat;
        background-position: 0.35rem center;
        font-weight: 600;
      }

      .terrain-button {
        position: relative;
        display: inline-flex;
        align-items: flex-end;
        justify-content: flex-start;
        gap: 0.35rem;
        padding: 0.35rem;
        border-radius: 0.5rem;
        border: 1px solid rgba(51, 65, 85, 0.9);
        background-color: rgba(2, 6, 23, 0.75);
        background-image: var(--terrain-texture);
        background-size: cover;
        background-position: center;
        color: #f8fafc;
        cursor: pointer;
        text-align: left;
        aspect-ratio: 1;
        min-height: 64px;
        transition: transform 140ms ease, border-color 140ms ease,
          box-shadow 140ms ease;
      }

      .terrain-button:hover,
      .terrain-button:focus-visible {
        transform: translateY(-1px);
        border-color: rgba(56, 189, 248, 0.5);
        box-shadow: 0 6px 18px rgba(15, 23, 42, 0.35);
        outline: none;
      }

      .terrain-button[data-active="true"] {
        border-color: rgba(129, 140, 248, 0.9);
        box-shadow: 0 0 0 2px rgba(129, 140, 248, 0.4);
      }

      .terrain-tile-number {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 1.4rem;
        padding: 0.1rem 0.35rem;
        border-radius: 0.4rem;
        background: rgba(15, 23, 42, 0.7);
        border: 1px solid rgba(15, 23, 42, 0.8);
        font-size: 0.8rem;
        font-weight: 700;
        text-shadow: 0 1px 1px rgba(15, 23, 42, 0.7);
      }

      .terrain-tile-chip {
        position: absolute;
        top: 0.35rem;
        left: 0.35rem;
        width: 0.65rem;
        height: 0.65rem;
        border-radius: 0.2rem;
        border: 1px solid rgba(2, 6, 23, 0.6);
        box-shadow: 0 1px 2px rgba(15, 23, 42, 0.4);
      }

      .main {
        grid-area: main;
        position: relative;
        overflow: hidden;
      }

      .main-panel {
        position: absolute;
        inset: 0;
        display: none;
        flex-direction: column;
        min-height: 0;
      }

      .main-panel.is-active {
        display: flex;
      }

      .workspace {
        position: relative;
        overflow: auto;
        padding: 1.75rem;
        flex: 1;
        min-height: 0;
      }

      .map-workspace {
        display: flex;
        align-items: stretch;
        justify-content: stretch;
        gap: 1.5rem;
        width: 100%;
        height: 100%;
        min-height: 0;
      }

      .workspace.map-workspace {
        padding: 0;
      }

      .landscape-stage {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        flex: 1 1 auto;
        min-width: 0;
        min-height: 0;
        background: transparent;
        border-radius: 0;
        padding: 0;
        border: none;
        box-shadow: none;
      }

      .map-info {
        display: flex;
        flex-wrap: wrap;
        gap: 1.25rem;
        font-size: 0.85rem;
        color: rgba(226, 232, 240, 0.75);
      }

      .json-output {
        font-family: "JetBrains Mono", "Fira Code", Menlo, Consolas, monospace;
        font-size: 0.8rem;
        line-height: 1.5;
        background: rgba(2, 6, 23, 0.75);
        border-radius: 0.85rem;
        border: 1px solid rgba(148, 163, 184, 0.25);
        padding: 0.85rem 1rem;
        color: rgba(226, 232, 240, 0.85);
        max-height: 240px;
        overflow: auto;
      }

      .json-output code {
        white-space: pre;
      }

      .actions-row {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
      }

      .actions-row button {
        padding: 0.6rem 1rem;
        border-radius: 0.75rem;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: rgba(2, 6, 23, 0.6);
        color: inherit;
        font-weight: 600;
        letter-spacing: 0.05em;
        cursor: pointer;
        transition: transform 120ms ease, border-color 120ms ease,
          background 120ms ease;
      }

      .actions-row button:hover,
      .actions-row button:focus-visible {
        transform: translateY(-1px);
        border-color: rgba(129, 140, 248, 0.6);
        background: rgba(129, 140, 248, 0.25);
        outline: none;
      }

      .actions-row button[data-variant="primary"] {
        background: linear-gradient(135deg, rgba(56, 189, 248, 0.2), rgba(129, 140, 248, 0.3));
        border-color: rgba(56, 189, 248, 0.55);
      }

      .actions-row button[data-variant="danger"] {
        border-color: rgba(248, 113, 113, 0.5);
        background: rgba(248, 113, 113, 0.18);
      }

      .palette-panel {
        display: none;
      }

      .palette-panel.is-active {
        display: block;
      }

      .palette-panel[hidden] {
        display: none;
      }

      .tab-panel-placeholder {
        border-radius: 0.9rem;
        border: 1px dashed rgba(148, 163, 184, 0.35);
        padding: 1rem;
        color: rgba(226, 232, 240, 0.75);
        background: rgba(2, 6, 23, 0.3);
        font-size: 0.85rem;
        line-height: 1.5;
      }

      .landscape-panel {
        display: grid;
        gap: 1rem;
      }

      .landscape-controls {
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
      }

      .landscape-controls button {
        width: 100%;
        padding: 0.55rem 0.9rem;
        border-radius: 0.7rem;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: rgba(2, 6, 23, 0.6);
        color: inherit;
        font-weight: 600;
        letter-spacing: 0.04em;
        cursor: pointer;
        transition: transform 120ms ease, border-color 120ms ease,
          background 120ms ease;
      }

      .landscape-controls button:hover,
      .landscape-controls button:focus-visible {
        transform: translateY(-1px);
        border-color: rgba(129, 140, 248, 0.6);
        background: rgba(129, 140, 248, 0.25);
        outline: none;
      }

      .landscape-controls button[aria-pressed="true"] {
        border-color: rgba(129, 140, 248, 0.6);
        background: rgba(129, 140, 248, 0.25);
      }

      .landscape-viewport {
        position: relative;
        border-radius: 0;
        border: none;
        overflow: hidden;
        flex: 1 1 auto;
        min-height: 0;
        height: 100%;
        background: radial-gradient(
          circle at top,
          rgba(30, 41, 59, 0.8),
          rgba(2, 6, 23, 0.85)
        );
      }

      .landscape-viewport canvas {
        width: 100%;
        height: 100%;
        display: block;
      }

      .landscape-error {
        border-radius: 0.75rem;
        border: 1px solid rgba(248, 113, 113, 0.4);
        background: rgba(248, 113, 113, 0.12);
        padding: 0.75rem 0.85rem;
        color: rgba(248, 113, 113, 0.95);
        font-size: 0.85rem;
        line-height: 1.5;
      }

      .map-cell {
        position: relative;
      }

      .map-cell[data-tile-number]::after {
        content: attr(data-tile-number);
        position: absolute;
        bottom: 0.25rem;
        right: 0.3rem;
        font-size: 0.8rem;
        font-weight: 700;
        color: #f8fafc;
        text-shadow: 0 1px 3px rgba(2, 6, 23, 0.7);
        background: rgba(2, 6, 23, 0.45);
        padding: 0.05rem 0.3rem;
        border-radius: 0.35rem;
        pointer-events: none;
      }

      .map-cell[data-height]::before {
        content: attr(data-height);
        position: absolute;
        top: 0.25rem;
        right: 0.3rem;
        font-size: 0.75rem;
        font-weight: 700;
        color: #f8fafc;
        text-shadow: 0 1px 3px rgba(2, 6, 23, 0.7);
        background: rgba(2, 6, 23, 0.45);
        padding: 0.05rem 0.3rem;
        border-radius: 0.35rem;
        pointer-events: none;
      }

      #mapGrid[data-show-tile-numbers="false"] .map-cell::after {
        display: none;
      }

      #mapGrid[data-show-heights="false"] .map-cell::before {
        display: none;
      }

      .map-maker-tabs,
      .map-maker-tab,
      .map-maker-update,
      .map-maker-history,
      .header-actions button,
      .header-actions a,
      .control input[type="number"],
      .control input[type="text"],
      .control textarea,
      .control select,
      .terrain-menu,
      .terrain-mode-button,
      .terrain-icon-button,
      .terrain-brush-value,
      .terrain-type-select select,
      .terrain-button,
      .terrain-swatch,
      .landscape-stage,
      .json-output,
      .actions-row button,
      .tab-panel-placeholder,
      .landscape-controls button,
      .landscape-viewport,
      .landscape-error {
        border-radius: 0;
      }

      .hint {
        font-size: 0.75rem;
        color: rgba(226, 232, 240, 0.6);
      }

      .map-maker-history {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        padding: 0.25rem;
        border-radius: 0.45rem;
        border: 1px solid rgba(71, 85, 105, 0.9);
        background: linear-gradient(180deg, #0f172a, #111827 70%);
        box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.8);
      }

      .map-maker-history .map-maker-tab {
        min-width: 2.1rem;
        text-align: center;
        padding: 0.35rem 0.4rem;
      }

      @media (max-width: 1080px) {
        body {
          grid-template-columns: 1fr;
          grid-template-rows: auto auto minmax(0, 1fr);
          grid-template-areas:
            "header"
            "sidebar"
            "main";
        }

        .sidebar {
          border-right: none;
          border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }

        .workspace {
          padding: 1.5rem;
        }
      }

      @media (max-width: 640px) {
        header {
          flex-direction: column;
          align-items: flex-start;
        }

        .map-maker-tabs {
          width: 100%;
          justify-content: flex-start;
        }

        .map-maker-update {
          width: 100%;
        }

        .header-actions {
          width: 100%;
          justify-content: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="map-maker-tabs" role="tablist" aria-label="Map maker tabs">
        <button
          class="map-maker-tab"
          type="button"
          role="tab"
          id="tab-areas"
          aria-selected="false"
          aria-controls="areasPanel"
          tabindex="-1"
          data-map-maker-tab="areas"
        >
          Select area
        </button>
        <button
          class="map-maker-tab"
          type="button"
          role="tab"
          id="tab-landshaft"
          aria-selected="false"
          aria-controls="landshaftPanel"
          tabindex="-1"
          data-map-maker-tab="landshaft"
        >
          View
        </button>
        <button
          class="map-maker-tab is-active"
          type="button"
          role="tab"
          id="tab-terrain"
          aria-selected="true"
          aria-controls="terrainPanel"
          tabindex="0"
          data-map-maker-tab="terrain"
        >
          Terrain
        </button>
        <button
          class="map-maker-tab"
          type="button"
          role="tab"
          id="tab-height"
          aria-selected="false"
          aria-controls="heightPanel"
          tabindex="-1"
          data-map-maker-tab="height"
        >
          Height
        </button>
        <button
          class="map-maker-tab"
          type="button"
          role="tab"
          id="tab-doors"
          aria-selected="false"
          aria-controls="doorsPanel"
          tabindex="-1"
          data-map-maker-tab="doors"
        >
          Doors
        </button>
        <button
          class="map-maker-tab"
          type="button"
          role="tab"
          id="tab-objects"
          aria-selected="false"
          aria-controls="objectsPanel"
          tabindex="-1"
          data-map-maker-tab="objects"
        >
          Objects
        </button>
        <button
          class="map-maker-tab"
          type="button"
          role="tab"
          id="tab-settings"
          aria-selected="false"
          aria-controls="settingsPanel"
          tabindex="-1"
          data-map-maker-tab="settings"
        >
          Settings
        </button>
      </div>
      <div class="map-maker-history" aria-label="Undo redo controls">
        <button
          type="button"
          id="undoBtn"
          class="map-maker-tab"
          disabled
          title="Undo (Ctrl+Z)"
          aria-label="Undo (Ctrl+Z)"
        >
          ↺
        </button>
        <button
          type="button"
          id="redoBtn"
          class="map-maker-tab"
          disabled
          title="Redo (Ctrl+Y)"
          aria-label="Redo (Ctrl+Y)"
        >
          ↻
        </button>
      </div>
      <div class="header-actions">
        <button id="saveLocalButton" type="button">Save locally</button>
        <button id="restoreLocalButton" type="button">Load local save</button>
        <button id="loadFileButton" type="button">Import file</button>
        <button id="downloadButton" type="button">Download JSON</button>
        <button id="copyButton" type="button">Copy JSON</button>
      </div>
      <input type="file" id="fileInput" accept="application/json" hidden />
    </header>

    <aside class="sidebar">
      <div
        class="tab-panel palette-panel"
        id="areasPanel"
        role="tabpanel"
        aria-labelledby="tab-areas"
        data-map-maker-panel="areas"
        hidden
      >
        <section class="sidebar-section">
          <h2>Select Area</h2>
          <p class="hint">
            Pick which game area map to edit. Save/load, import, and download actions apply
            to the selected area.
          </p>
          <div class="objects-palette" id="areaList" role="list"></div>
        </section>
        <section class="sidebar-section">
          <h2>Current Area</h2>
          <div class="control-group">
            <div class="control">
              <label for="selectedAreaName">Area name</label>
              <input id="selectedAreaName" type="text" readonly />
            </div>
            <div class="control">
              <label for="selectedAreaId">Area id</label>
              <input id="selectedAreaId" type="text" readonly />
            </div>
            <div class="control">
              <label for="selectedAreaDescription">Description</label>
              <textarea id="selectedAreaDescription" readonly></textarea>
            </div>
          </div>
        </section>
      </div>
      <div
        class="tab-panel palette-panel is-active"
        id="terrainPanel"
        role="tabpanel"
        aria-labelledby="tab-terrain"
        data-map-maker-panel="terrain"
      >
        <section class="sidebar-section terrain-menu">
          <div class="terrain-menu-actions">
            <button
              class="terrain-mode-button"
              type="button"
              data-terrain-mode="brush"
              aria-pressed="false"
            >
              Use Brush
            </button>
            <button
              class="terrain-mode-button"
              type="button"
              data-terrain-mode="draw"
              aria-pressed="false"
            >
              Draw on map
            </button>
          </div>
          <div class="terrain-control-row terrain-brush-row" id="terrainBrushRow">
            <label class="terrain-control-label" for="terrainBrushSize">
              Brush size
            </label>
            <div class="terrain-brush-size">
              <input
                id="terrainBrushSize"
                type="range"
                min="1"
                max="150"
                step="1"
                value="1"
              />
              <span class="terrain-brush-value" id="terrainBrushSizeValue">1</span>
            </div>
          </div>
          <div class="terrain-control-row terrain-draw-row" id="terrainDrawRow" hidden>
            <div class="terrain-draw-actions">
              <button
                class="terrain-action-button"
                type="button"
                id="terrainApplyButton"
                disabled
              >
                Apply
              </button>
              <button
                class="terrain-action-button"
                type="button"
                id="terrainCancelButton"
                disabled
              >
                Cancel
              </button>
            </div>
          </div>
          <div class="terrain-control-row">
            <span class="terrain-control-label">Rotation</span>
            <div class="terrain-rotation">
              <span id="terrainRotationDisplay">0°</span>
              <button
                class="terrain-icon-button"
                type="button"
                data-rotation="left"
                aria-label="Rotate left"
              >
                ⟲
              </button>
              <button
                class="terrain-icon-button"
                type="button"
                data-rotation="right"
                aria-label="Rotate right"
              >
                ⟳
              </button>
            </div>
          </div>
          <div class="terrain-control-row terrain-selection-row">
            <div class="terrain-selection-group">
              <span class="terrain-control-label">Terrain type</span>
              <label class="terrain-type-select" for="terrainTypeSelect">
                <select id="terrainTypeSelect"></select>
              </label>
            </div>
            <div class="terrain-selection-group">
              <span class="terrain-control-label">Terrain tile</span>
              <label class="terrain-type-select" for="terrainTileSelect">
                <select id="terrainTileSelect"></select>
              </label>
            </div>
          </div>
        </section>

        <section class="sidebar-section">
          <h2>Terrain Palette</h2>
          <div class="terrain-palette" id="terrainPalette"></div>
        </section>
      </div>
      <div
        class="tab-panel palette-panel"
        id="doorsPanel"
        role="tabpanel"
        aria-labelledby="tab-doors"
        data-map-maker-panel="doors"
        hidden
      >
        <section class="sidebar-section">
          <div class="terrain-menu-actions">
            <button
              class="terrain-mode-button"
              type="button"
              data-door-mode="place"
              aria-pressed="false"
            >
              Place doors
            </button>
          </div>
          <div class="door-list-header">
            <span>Placed doors</span>
            <span class="door-list-count" id="doorListCount">0</span>
          </div>
          <p class="door-list-empty" id="doorListEmpty">No doors placed yet.</p>
          <ul class="door-list" id="doorList" aria-live="polite"></ul>
        </section>
      </div>
      <div
        class="tab-panel palette-panel"
        id="objectsPanel"
        role="tabpanel"
        aria-labelledby="tab-objects"
        data-map-maker-panel="objects"
        hidden
      >
        <section class="sidebar-section">
          <h2>Placed Objects</h2>
          <p class="hint">Click an object to center and highlight it on the map.</p>
          <div class="object-list-header">
            <span>Placed objects</span>
            <span class="object-list-count" id="objectListCount">0</span>
          </div>
          <p class="object-list-empty" id="objectListEmpty">No objects placed yet.</p>
          <ul class="object-list" id="objectList" aria-live="polite"></ul>
        </section>
        <section class="sidebar-section">
          <h2>Objects Palette</h2>
          <p class="hint" id="objectsPaletteStatus">Loading model library…</p>
          <div class="actions-row">
            <button
              class="terrain-action-button"
              type="button"
              id="clearSelectedObjectButton"
              disabled
            >
              Deactivate selected
            </button>
          </div>
          <div class="objects-palette" id="objectsPalette"></div>
        </section>
      </div>
      <div
        class="tab-panel palette-panel"
        id="heightPanel"
        role="tabpanel"
        aria-labelledby="tab-height"
        data-map-maker-panel="height"
        hidden
      >
        <section class="sidebar-section terrain-menu">
          <div class="terrain-menu-actions">
            <button
              class="terrain-mode-button"
              type="button"
              data-height-mode="brush"
              aria-pressed="false"
            >
              Use Brush
            </button>
            <button
              class="terrain-mode-button"
              type="button"
              data-height-mode="draw"
              aria-pressed="false"
            >
              Draw on map
            </button>
          </div>
          <div class="terrain-control-row" id="heightBrushRow" hidden>
            <label class="terrain-control-label" for="heightBrushSize">
              Brush size
            </label>
            <div class="terrain-brush-size">
              <input
                id="heightBrushSize"
                type="range"
                min="1"
                max="150"
                step="1"
                value="1"
              />
              <span class="terrain-brush-value" id="heightBrushSizeValue">1</span>
            </div>
          </div>
          <div class="terrain-control-row">
            <label class="terrain-control-label" for="heightValueInput">
              Height
            </label>
            <div class="height-value-control">
              <input
                id="heightValueInput"
                type="number"
                min="0"
                max="255"
                step="1"
                value="0"
              />
              <input
                id="heightValueSlider"
                type="range"
                min="0"
                max="255"
                step="1"
                value="0"
              />
            </div>
          </div>
          <div class="height-presets" id="heightPresets">
            <button type="button" class="terrain-action-button" data-height-preset="0">
              0
            </button>
            <button type="button" class="terrain-action-button" data-height-preset="64">
              64
            </button>
            <button type="button" class="terrain-action-button" data-height-preset="128">
              128
            </button>
            <button type="button" class="terrain-action-button" data-height-preset="192">
              192
            </button>
            <button type="button" class="terrain-action-button" data-height-preset="255">
              255
            </button>
          </div>
          <div class="terrain-control-row terrain-draw-row" id="heightDrawRow" hidden>
            <div class="terrain-draw-actions">
              <button
                class="terrain-action-button"
                type="button"
                id="heightApplyButton"
                disabled
              >
                Apply
              </button>
              <button
                class="terrain-action-button"
                type="button"
                id="heightCancelButton"
                disabled
              >
                Cancel
              </button>
            </div>
          </div>
        </section>
      </div>
      <div
        class="tab-panel palette-panel"
        id="landshaftPanel"
        role="tabpanel"
        aria-labelledby="tab-landshaft"
        data-map-maker-panel="landshaft"
        hidden
      >
        <section class="sidebar-section landscape-panel">
          <div class="landscape-controls">
            <button id="landscapeResetButton" type="button">Reset camera</button>
            <button
              class="terrain-mode-button"
              type="button"
              id="showHeightButton"
              aria-pressed="false"
            >
              Show Heights
            </button>
            <button
              id="landscapeTypeToggle"
              type="button"
              aria-pressed="true"
            >
              Terrain types: On
            </button>
            <button
              id="landscapeTextureToggle"
              type="button"
              aria-pressed="true"
            >
              Terrain textures: On
            </button>
            <button
              id="landscapeTileNumberToggle"
              type="button"
              aria-pressed="true"
            >
              Tile numbers: On
            </button>
          </div>
          <p class="tab-panel-placeholder">
            The view preview now lives in the main terrain workspace.
          </p>
        </section>
      </div>
      <div
        class="tab-panel palette-panel"
        id="settingsPanel"
        role="tabpanel"
        aria-labelledby="tab-settings"
        data-map-maker-panel="settings"
        hidden
      >
        <section class="sidebar-section">
          <h2>Map Settings</h2>
          <div class="control-group">
            <div class="control">
              <label for="mapNameInput">Map name</label>
              <input id="mapNameInput" type="text" placeholder="Outside perimeter" />
            </div>
            <div class="control">
              <label for="regionInput">Region identifier</label>
              <input id="regionInput" type="text" placeholder="perimeter_north" />
            </div>
            <div class="control">
              <label for="mapNotesInput">Designer notes</label>
              <textarea id="mapNotesInput" placeholder="Describe key landmarks, hazards, or traversal rules."></textarea>
            </div>
            <div class="control">
              <label>Dimensions</label>
              <div class="actions-row">
                <input id="widthInput" type="number" min="1" max="200" step="1" />
                ×
                <input id="heightInput" type="number" min="1" max="200" step="1" />
                <button id="resizeButton" type="button" data-variant="primary">Apply size</button>
              </div>
              <div class="hint">Current map keeps existing terrain within new bounds.</div>
            </div>
          </div>
        </section>

        <section class="sidebar-section">
          <h2>Generation</h2>
          <div class="control-group">
            <div class="control">
              <label>Height range</label>
              <div class="actions-row">
                <input id="generateHeightMin" type="number" min="0" max="255" step="1" value="0" />
                –
                <input id="generateHeightMax" type="number" min="0" max="255" step="1" value="64" />
              </div>
              <div class="hint">Heights are clamped between 0 and 255.</div>
            </div>
            <div class="control">
              <label for="generateHillsCount">Hills count</label>
              <input id="generateHillsCount" type="number" min="0" max="40000" step="1" value="8" />
              <div class="hint">Higher counts add more peaks to the height map.</div>
            </div>
          </div>
        </section>

        <section class="sidebar-section">
          <h2>Import JSON</h2>
          <p>Paste an exported map definition to replace the current layout.</p>
          <div class="control">
            <label for="importTextarea">Map JSON</label>
            <textarea id="importTextarea" placeholder="{ &quot;name&quot;: &quot;outside-yard&quot;, &quot;width&quot;: 24, ... }"></textarea>
          </div>
          <div class="actions-row">
            <button id="importButton" type="button">Load JSON</button>
            <button id="generateButton" type="button">Generate map</button>
            <button id="resetButton" type="button" data-variant="danger">Reset map</button>
          </div>
        </section>

        <section class="sidebar-section">
          <h2>Live JSON</h2>
          <div class="json-output" aria-live="polite">
            <code id="jsonPreview"></code>
          </div>
        </section>
      </div>
    </aside>

    <main class="main">
      <div class="main-panel is-active" data-map-maker-main="terrain">
        <div class="workspace map-workspace">
          <section class="landscape-stage" aria-label="View preview">
            <div class="landscape-viewport">
              <canvas id="landscapeViewport" aria-label="3D view preview"></canvas>
            </div>
            <div class="landscape-error" id="landscapeError" role="status" hidden>
              WebGL support is unavailable in this browser. Try a different browser
              or enable hardware acceleration to preview the terrain.
            </div>
          </section>
        </div>
      </div>
    </main>

    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.161.0/build/three.module.js"
        }
      }
    </script>
    <script type="module" src="scripts/map-maker.js"></script>
  </body>
</html>
