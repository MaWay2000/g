<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dusty Nova</title>
    <link rel="preload" as="audio" href="images/index/button_hower.mp3" />
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background-color: #000;
        color: #f9fafb;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        overflow: hidden;
      }

      body.has-modal-open {
        overflow: hidden;
      }

      figure {
        margin: 0;
        height: 100vh;
      }

      .monitor-header {
        position: fixed;
        top: 0;
        left: 50%;
        transform: translateX(-50%);
        width: min(42rem, 100vw);
        max-width: 780px;
        pointer-events: none;
        user-select: none;
        z-index: 4;
      }

      .monitor-header__image {
        display: block;
        width: 100%;
        height: auto;
      }

      .monitor-station {
        --screen-top: 18%;
        --screen-left: 11%;
        --screen-right: 11%;
        --screen-bottom: 43%;
        position: fixed;
        bottom: 0;
        left: 0;
        width: min(27rem, 42vw);
        max-width: 440px;
        pointer-events: none;
        user-select: none;
        transform: translate(-10%, 13%);
      }

      .auth-actions {
        position: absolute;
        top: var(--screen-top);
        left: var(--screen-left);
        right: var(--screen-right);
        bottom: var(--screen-bottom);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.75rem;
        pointer-events: none;
        opacity: 1;
        transition: opacity 300ms ease;
        transform: translateY(-5px);
      }

      .auth-actions__content {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        padding: clamp(1.65rem, 3vw, 2.35rem) clamp(1.4rem, 2.4vw, 2rem);
        border-radius: 1.35rem;
        background: rgba(3, 7, 18, 0.82);
        border: 1px solid rgba(52, 211, 153, 0.35);
        box-shadow: 0 24px 48px rgba(6, 15, 11, 0.6);
        overflow: hidden;
        isolation: isolate;
        pointer-events: auto;
        transition: transform 300ms ease, opacity 300ms ease;
        backdrop-filter: blur(3px);
      }

      .auth-screen-saver {
        position: absolute;
        inset: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0.75rem;
        padding: 1.5rem;
        border-radius: inherit;
        background: radial-gradient(
            circle at 50% 30%,
            rgba(16, 185, 129, 0.2) 0%,
            rgba(4, 12, 20, 0.85) 60%,
            rgba(2, 6, 12, 0.92) 100%
          ),
          rgba(2, 6, 12, 0.88);
        text-align: center;
        pointer-events: none;
        z-index: 3;
        overflow: hidden;
        color: rgba(226, 232, 240, 0.92);
        letter-spacing: 0.08em;
        transition: opacity 320ms ease, transform 320ms ease;
      }

      .auth-screen-saver::before {
        content: "";
        position: absolute;
        inset: -45% -35% -45% -35%;
        background:
          radial-gradient(
            120% 120% at 50% 50%,
            rgba(59, 130, 246, 0.16) 0%,
            rgba(8, 47, 73, 0.05) 40%,
            rgba(2, 6, 23, 0) 65%
          ),
          repeating-linear-gradient(
            0deg,
            rgba(20, 83, 45, 0.22),
            rgba(20, 83, 45, 0.22) 2px,
            transparent 2px,
            transparent 4px
          );
        mix-blend-mode: screen;
        opacity: 0.85;
        animation: auth-screen-saver-pan 7.5s linear infinite;
        pointer-events: none;
        z-index: 0;
      }

      .auth-screen-saver::after {
        content: "";
        position: absolute;
        inset: -150% -45%;
        background: linear-gradient(
          0deg,
          transparent 0%,
          rgba(16, 185, 129, 0) 30%,
          rgba(16, 185, 129, 0.45) 48%,
          rgba(52, 211, 153, 0.75) 50%,
          rgba(16, 185, 129, 0.45) 52%,
          rgba(16, 185, 129, 0) 70%,
          transparent 100%
        );
        opacity: 0.6;
        animation: auth-screen-saver-scan 3.2s linear infinite;
        pointer-events: none;
        z-index: 0;
      }

      .auth-screen-saver__label,
      .auth-screen-saver__divider,
      .auth-screen-saver__hint {
        position: relative;
        z-index: 1;
      }

      .auth-screen-saver__label {
        font-size: 0.75rem;
        text-transform: uppercase;
        color: rgba(148, 163, 184, 0.85);
        letter-spacing: 0.26em;
      }

      .auth-screen-saver__divider {
        width: min(140px, 70%);
        height: 1px;
        background: linear-gradient(
          90deg,
          rgba(16, 185, 129, 0),
          rgba(16, 185, 129, 0.65) 50%,
          rgba(16, 185, 129, 0)
        );
        box-shadow: 0 0 12px rgba(16, 185, 129, 0.4);
      }

      .auth-screen-saver__hint {
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        color: rgba(110, 231, 183, 0.95);
        animation: auth-screen-saver-hint 2.4s ease-in-out infinite;
      }

      .auth-screen-saver.is-dismissed {
        opacity: 0;
        transform: scale(1.02);
      }

      .auth-screen-saver.is-dismissed::before,
      .auth-screen-saver.is-dismissed::after {
        opacity: 0;
      }

      .auth-actions__content::before {
        content: "";
        position: absolute;
        inset: -15% -10% -15%;
        background-image:
          linear-gradient(180deg, rgba(1, 11, 8, 0.92) 0%, rgba(1, 24, 18, 0.78) 100%),
          url("data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20width%3D%27160%27%20height%3D%27320%27%3E%0A%20%20%3Crect%20width%3D%27160%27%20height%3D%27320%27%20fill%3D%27none%27%2F%3E%0A%20%20%3Cg%20fill%3D%27%2316f89d%27%20font-family%3D%27monospace%27%20font-size%3D%2718%27%20opacity%3D%270.45%27%3E%0A%20%20%20%20%3Ctext%20x%3D%274%27%20y%3D%2720%27%3E1010010110010110%3C%2Ftext%3E%0A%20%20%20%20%3Ctext%20x%3D%2720%27%20y%3D%2752%27%3E0010110100100101%3C%2Ftext%3E%0A%20%20%20%20%3Ctext%20x%3D%278%27%20y%3D%2792%27%3E1101001011010010%3C%2Ftext%3E%0A%20%20%20%20%3Ctext%20x%3D%2730%27%20y%3D%27132%27%3E0101100101100101%3C%2Ftext%3E%0A%20%20%20%20%3Ctext%20x%3D%27-6%27%20y%3D%27172%27%3E1010010110100101%3C%2Ftext%3E%0A%20%20%20%20%3Ctext%20x%3D%2716%27%20y%3D%27212%27%3E0101101001011010%3C%2Ftext%3E%0A%20%20%20%20%3Ctext%20x%3D%272%27%20y%3D%27252%27%3E1001011010010110%3C%2Ftext%3E%0A%20%20%20%20%3Ctext%20x%3D%2726%27%20y%3D%27292%27%3E0010110100101101%3C%2Ftext%3E%0A%20%20%3C%2Fg%3E%0A%3C%2Fsvg%3E");
        background-repeat: no-repeat, repeat;
        background-size: cover, 140px 280px;
        background-position: center, 0 0;
        opacity: 0.95;
        mix-blend-mode: screen;
        animation: matrix-scroll 12s linear infinite;
        pointer-events: none;
        z-index: 0;
      }

      .auth-actions__content::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        border: 1px solid rgba(16, 185, 129, 0.35);
        box-shadow:
          inset 0 0 24px rgba(16, 185, 129, 0.22),
          inset 0 0 4px rgba(59, 130, 246, 0.1);
        pointer-events: none;
        z-index: 1;
      }

      .auth-actions.is-hidden {
        opacity: 0;
      }

      .auth-actions.is-hidden .auth-actions__content {
        opacity: 0;
        transform: translateY(12px);
      }

      .auth-actions__buttons {
        position: relative;
        display: flex;
        flex-direction: column;
        gap: 0.85rem;
        width: 100%;
        z-index: 2;
        transition: opacity 260ms ease;
      }

      .auth-actions__content.is-screen-saver-active .auth-actions__buttons {
        opacity: 0;
        visibility: hidden;
        pointer-events: none;
      }

      .auth-modal {
        position: fixed;
        inset: 0;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: clamp(2rem, 6vh, 4rem) clamp(1.5rem, 3vw, 3rem);
        background: transparent;
        z-index: 40;
        pointer-events: none;
        opacity: 0;
        transition: opacity 280ms ease;
        overflow: hidden;
        height: 100vh;
        padding-top: 0;
      }

      .auth-modal[hidden] {
        display: none;
      }

      .auth-modal.is-open {
        pointer-events: auto;
        opacity: 1;
      }

      .auth-modal__backdrop {
        position: absolute;
        inset: 0;
        background: linear-gradient(
            135deg,
            rgba(2, 6, 23, 0.8),
            rgba(15, 23, 42, 0.65)
          )
          rgba(2, 6, 23, 0.75);
        backdrop-filter: blur(8px);
        opacity: 0.92;
        z-index: 0;
      }

      .auth-modal__matrix {
        position: absolute;
        inset: 0;
        overflow: hidden;
        pointer-events: none;
        opacity: 0;
        transition: opacity 320ms ease;
        z-index: 1;
      }

      .auth-modal.is-open .auth-modal__matrix {
        opacity: 0.9;
      }

      .auth-modal__matrix::before {
        content: "";
        position: absolute;
        inset: -45% -35% -45% -35%;
        background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20width%3D%27160%27%20height%3D%27320%27%3E%0A%20%20%3Crect%20width%3D%27160%27%20height%3D%27320%27%20fill%3D%27none%27%2F%3E%0A%20%20%3Cg%20fill%3D%27%2316f89d%27%20font-family%3D%27monospace%27%20font-size%3D%2718%27%20opacity%3D%270.45%27%3E%0A%20%20%20%20%3Ctext%20x%3D%274%27%20y%3D%2720%27%3E1010010110010110%3C%2Ftext%3E%0A%20%20%20%20%3Ctext%20x%3D%2720%27%20y%3D%2752%27%3E0010110100100101%3C%2Ftext%3E%0A%20%20%20%20%3Ctext%20x%3D%278%27%20y%3D%2792%27%3E1101001011010010%3C%2Ftext%3E%0A%20%20%20%20%3Ctext%20x%3D%2730%27%20y%3D%27132%27%3E0101100101100101%3C%2Ftext%3E%0A%20%20%20%20%3Ctext%20x%3D%27-6%27%20y%3D%27172%27%3E1010010110100101%3C%2Ftext%3E%0A%20%20%20%20%3Ctext%20x%3D%2716%27%20y%3D%27212%27%3E0101101001011010%3C%2Ftext%3E%0A%20%20%20%20%3Ctext%20x%3D%272%27%20y%3D%27252%27%3E1001011010010110%3C%2Ftext%3E%0A%20%20%20%20%3Ctext%20x%3D%2726%27%20y%3D%27292%27%3E0010110100101101%3C%2Ftext%3E%0A%20%20%3C%2Fg%3E%0A%3C%2Fsvg%3E");
        background-repeat: repeat;
        background-size: 200px 360px;
        background-position: 0 0;
        animation: auth-modal-matrix-scroll 18s linear infinite;
        opacity: 0.85;
        mix-blend-mode: screen;
      }

      .auth-modal__matrix::after {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
            circle at 50% 20%,
            rgba(59, 130, 246, 0.18) 0%,
            rgba(2, 6, 23, 0.65) 55%,
            rgba(1, 12, 20, 0.85) 100%
          ),
          linear-gradient(180deg, rgba(2, 6, 23, 0.65), rgba(2, 6, 23, 0.95));
        opacity: 0.85;
      }

      .auth-modal__dialog {
        position: relative;
        width: min(100%, 1205px);
        max-height: none;
        height: 100%;
        transform: translateY(24px);
        transition: transform 280ms ease, opacity 280ms ease;
        opacity: 0;
        display: flex;
        flex-direction: column;
        z-index: 2;
      }

      .auth-modal.is-open .auth-modal__dialog {
        transform: translateY(0);
        opacity: 1;
      }

      .auth-modal__close {
        position: static;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 2.35rem;
        height: 2.35rem;
        margin-left: clamp(0.65rem, 1.4vw, 1rem);
        border-radius: 9999px;
        border: 1px solid rgba(148, 163, 184, 0.35);
        background: rgba(15, 23, 42, 0.75);
        color: rgba(226, 232, 240, 0.92);
        cursor: pointer;
        transition: transform 180ms ease, box-shadow 180ms ease, border-color 180ms ease;
        flex-shrink: 0;
      }

      .auth-modal__close:hover,
      .auth-modal__close:focus-visible {
        transform: translateY(-1px);
        border-color: rgba(148, 163, 184, 0.55);
        box-shadow: 0 18px 40px rgba(15, 23, 42, 0.55);
        outline: none;
      }

      .auth-modal__content {
        position: relative;
        overflow: hidden;
        max-height: inherit;
        padding: clamp(0.1rem, 0.7vw, 0.4rem) clamp(1.6rem, 2.8vw, 2.25rem)
          clamp(1.6rem, 2.8vw, 2.25rem);
        padding-top: 0;
        padding-inline: 0;
        display: flex;
        justify-content: center;
        flex: 1;
      }

      .auth-card {
        background: none;
        border-radius: 1.35rem;
        border: none;
        box-shadow: none;
        backdrop-filter: none;
        padding: clamp(1.85rem, 3vw, 2.75rem);
        color: rgba(248, 250, 252, 0.98);
        width: min(100%, 480px);
        margin: 0 auto;
      }

      .auth-card--monitor {
        background: transparent;
        border: none;
        box-shadow: none;
        padding: 0 0 clamp(0.9rem, 1.8vw, 1.4rem);
        width: min(100%, 1205px);
        max-width: 1205px;
        position: relative;
        color: rgba(248, 250, 252, 0.98);
        --monitor-screen-top: 6%;
        --monitor-screen-left: 12%;
        --monitor-screen-right: 12%;
        --monitor-screen-bottom: 16%;
      }

      .auth-card--monitor .auth-card__monitor-frame {
        display: block;
        width: 100%;
        height: auto;
        filter: drop-shadow(0 24px 48px rgba(15, 23, 42, 0.65));
        user-select: none;
        pointer-events: none;
      }

      .auth-card--monitor .auth-card__monitor-content {
        position: absolute;
        top: var(--monitor-screen-top, 6%);
        left: var(--monitor-screen-left, 12%);
        right: var(--monitor-screen-right, 12%);
        bottom: var(--monitor-screen-bottom, 16%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        padding: clamp(1.85rem, 3vw, 2.75rem);
        border-radius: 1.35rem;
        border: none;
        background: none;
        box-shadow: none;
      }

      .auth-card[data-auth-view="login"] .auth-card__monitor-content,
      .auth-card[data-auth-view="register"] .auth-card__monitor-content,
      .auth-card[data-auth-view="guest"] .auth-card__monitor-content {
        justify-content: flex-start;
        top: calc(var(--monitor-screen-top, 6%) + 85px);
        bottom: calc(var(--monitor-screen-bottom, 16%) - 65px);
      }

      .auth-card--monitor .auth-card__header,
      .auth-card--monitor .auth-card__form,
      .auth-card--monitor .auth-card__footer {
        width: 100%;
      }

      .auth-card--monitor .auth-card__header {
        margin-bottom: clamp(1.25rem, 3vw, 1.85rem);
      }

      .auth-card--monitor .auth-card__footer {
        margin-top: clamp(1.75rem, 3vw, 2.25rem);
      }

      .auth-card__hint {
        margin-top: clamp(0.75rem, 1.4vw, 1.1rem);
        font-size: 0.95rem;
        line-height: 1.5;
        color: rgba(148, 163, 184, 0.85);
      }

      .auth-card--monitor .auth-card__brand img {
        filter: drop-shadow(0 6px 14px rgba(30, 64, 175, 0.35));
      }

      .auth-card--monitor::before,
      .auth-card--monitor::after {
        content: none;
      }

      .auth-card--monitor > * {
        position: relative;
        z-index: 1;
      }

      .auth-card__header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: clamp(0.75rem, 1.5vw, 1.25rem);
        margin-bottom: 2.2rem;
        color: rgba(148, 163, 184, 0.85);
      }

      .auth-card__headline {
        display: inline-flex;
        align-items: center;
        gap: clamp(0.5rem, 1vw, 0.85rem);
      }

      .auth-card__brand {
        display: inline-flex;
        align-items: center;
        gap: 0.7rem;
        font-size: 0.95rem;
        font-weight: 600;
        letter-spacing: 0.04em;
      }

      .auth-card__brand img {
        height: 4.8rem;
        width: auto;
        display: block;
      }

      .auth-card[data-auth-view="login"] .auth-card__title {
        font-size: clamp(1.17rem, 2vw, 1.57rem);
      }

      .auth-card__title {
        margin: 0;
        font-size: clamp(1.17rem, 2vw, 1.57rem);
        font-weight: 600;
        color: rgba(224, 242, 254, 0.98);
      }

      .auth-card__description {
        margin: 0 0 1.9rem;
        color: rgba(226, 232, 240, 0.88);
        font-size: 0.975rem;
        line-height: 1.65;
      }

      .auth-card__form {
        display: grid;
        gap: 1.1rem;
      }

      .auth-card__field label {
        display: block;
        margin-bottom: 0.4rem;
        font-size: 0.85rem;
        color: rgba(226, 232, 240, 0.95);
      }

      .auth-card__field input[type="text"],
      .auth-card__field input[type="email"],
      .auth-card__field input[type="password"] {
        width: 100%;
        padding: 0.8rem 1rem;
        border-radius: 0.9rem;
        border: 1px solid rgba(148, 163, 184, 0.28);
        background: rgba(15, 23, 42, 0.7);
        color: inherit;
        font-size: 1rem;
        transition: border-color 150ms ease, box-shadow 150ms ease, transform 150ms ease;
      }

      .auth-card__field input[type="text"]:focus,
      .auth-card__field input[type="email"]:focus,
      .auth-card__field input[type="password"]:focus {
        outline: none;
        border-color: rgba(96, 165, 250, 0.75);
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.25);
        transform: translateY(-1px);
      }

      .auth-card__row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        font-size: 0.85rem;
        color: rgba(148, 163, 184, 0.95);
      }

      .auth-card__row label {
        display: flex;
        align-items: center;
        gap: 0.55rem;
        margin: 0;
        cursor: pointer;
      }

      .auth-card__row input[type="checkbox"] {
        width: 1rem;
        height: 1rem;
        accent-color: #3b82f6;
      }

      .auth-card__terms {
        display: flex;
        align-items: flex-start;
        gap: 0.65rem;
        font-size: 0.82rem;
        color: rgba(148, 163, 184, 0.95);
        line-height: 1.6;
      }

      .auth-card__terms input[type="checkbox"] {
        margin-top: 0.2rem;
        accent-color: #6366f1;
      }

      .auth-card__submit {
        width: 100%;
        padding: 0.85rem 1rem;
        border-radius: 999px;
        border: none;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        color: inherit;
        background: linear-gradient(135deg, #3b82f6, #6366f1);
        transition: transform 150ms ease, box-shadow 150ms ease;
      }

      .auth-card__submit:hover {
        transform: translateY(-1px);
        box-shadow: 0 18px 35px -15px rgba(99, 102, 241, 0.65);
      }

      .auth-card__submit:focus-visible {
        outline: none;
        box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.35);
      }

      .auth-card__footer {
        margin-top: 1.75rem;
        text-align: center;
        font-size: 0.9rem;
        color: rgba(148, 163, 184, 0.95);
      }

      .auth-card__link {
        color: #93c5fd;
        text-decoration: none;
        font-weight: 500;
      }

      .auth-card[data-auth-view="register"] .auth-card__link {
        color: #c4b5fd;
      }

      .auth-card__link:hover {
        text-decoration: underline;
      }

      .auth-card__legal-link {
        color: inherit;
        text-decoration: underline;
      }

      .story-card {
        position: fixed;
        top: 3rem;
        left: 3rem;
        transform: none;
        width: min(30rem, 90vw);
        border-radius: 1.25rem;
        background: linear-gradient(
          155deg,
          rgba(15, 23, 42, 0.35) 0%,
          rgba(30, 41, 59, 0.22) 100%
        );
        border: 1px solid rgba(148, 163, 184, 0.12);
        box-shadow: 0 25px 45px rgba(15, 23, 42, 0.4);
        backdrop-filter: blur(12px);
        padding: 2.75rem 2.5rem;
        pointer-events: auto;
      }

      .story-card h2 {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 600;
        letter-spacing: 0.02em;
        color: #e0f2fe;
      }

      .story-card__header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1.25rem;
        flex-wrap: wrap;
        margin-bottom: 1.5rem;
      }

      .story-card__nav {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.35rem 0.75rem;
        border-radius: 9999px;
        background: rgba(15, 23, 42, 0.55);
        border: 1px solid rgba(148, 163, 184, 0.3);
        box-shadow: inset 0 0 12px rgba(15, 23, 42, 0.35);
        flex-shrink: 0;
      }

      .story-card__progress {
        display: inline-flex;
        align-items: baseline;
        gap: 0.2rem;
        font-size: 0.8rem;
        font-weight: 600;
        letter-spacing: 0.08em;
        color: rgba(226, 232, 240, 0.75);
        min-width: 2.5rem;
        justify-content: center;
      }

      .story-card__body {
        position: relative;
        min-height: 11.5rem;
      }

      .story-card__section {
        margin: 0;
        line-height: 1.7;
        color: rgba(226, 232, 240, 0.9);
        font-size: 0.975rem;
        display: none;
      }

      .story-card__section.is-active {
        display: block;
        animation: story-fade 320ms ease;
      }

      .story-card__section-title {
        margin: 0 0 0.35rem;
        font-size: 1.05rem;
        font-weight: 600;
        color: #bae6fd;
      }

      .story-card__section p {
        margin: 0;
      }

      .story-card__arrow {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 2.1rem;
        height: 2.1rem;
        border-radius: 9999px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        background: radial-gradient(circle at 30% 30%, rgba(148, 163, 184, 0.25), rgba(15, 23, 42, 0.5));
        color: rgba(226, 232, 240, 0.95);
        font-size: 1.2rem;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease,
          border-color 0.2s ease, color 0.2s ease;
      }

      .story-card__arrow:hover,
      .story-card__arrow:focus-visible {
        transform: translateY(-1px);
        border-color: rgba(148, 163, 184, 0.6);
        color: #f0f9ff;
        box-shadow: 0 12px 24px rgba(15, 23, 42, 0.45);
      }

      .story-card__arrow:focus-visible {
        outline: 2px solid rgba(148, 163, 184, 0.65);
        outline-offset: 3px;
      }

      .story-card__arrow:disabled {
        opacity: 0.35;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      @keyframes story-fade {
        from {
          opacity: 0;
          transform: translateY(8px);
        }

        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes auth-screen-saver-pan {
        0% {
          transform: translate(-12%, -8%) rotate(4deg);
        }

        50% {
          transform: translate(10%, 6%) rotate(-2deg);
        }

        100% {
          transform: translate(-12%, -8%) rotate(4deg);
        }
      }

      @keyframes auth-screen-saver-scan {
        0% {
          transform: translateY(-60%);
          opacity: 0;
        }

        25% {
          opacity: 0.6;
        }

        50% {
          opacity: 0.8;
        }

        100% {
          transform: translateY(60%);
          opacity: 0;
        }
      }

      @keyframes auth-screen-saver-hint {
        0% {
          opacity: 0.35;
          transform: translateY(0);
        }

        45% {
          opacity: 1;
          transform: translateY(-2px);
        }

        100% {
          opacity: 0.35;
          transform: translateY(0);
        }
      }

      .auth-actions__button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 0.7rem 0.5rem;
        width: 100%;
        border-radius: 9999px;
        border: 1px solid rgba(34, 197, 94, 0.35);
        color: rgba(226, 252, 239, 0.92);
        text-decoration: none;
        font-size: 0.85rem;
        font-weight: 600;
        letter-spacing: 0.02em;
        transition: transform 0.2s ease, box-shadow 0.2s ease,
          background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease,
          filter 0.2s ease;
        background-color: rgba(8, 47, 35, 0.6);
        cursor: pointer;
      }

      .auth-actions__button:hover,
      .auth-actions__button:focus-visible {
        transform: translateY(-2px);
        box-shadow: 0 16px 30px rgba(4, 120, 87, 0.45);
        background: linear-gradient(135deg, #22c55e, #14b8a6);
        border-color: rgba(45, 212, 191, 0.65);
        color: #022c22;
      }

      .auth-actions__button:focus-visible {
        outline: 2px solid rgba(34, 197, 94, 0.85);
        outline-offset: 3px;
      }

      .auth-actions__button--ghost {
        background-color: rgba(2, 44, 34, 0.35);
        border-color: rgba(45, 212, 191, 0.28);
        color: rgba(209, 250, 229, 0.75);
      }

      .auth-actions__button--ghost:hover,
      .auth-actions__button--ghost:focus-visible {
        background: linear-gradient(135deg, rgba(125, 211, 252, 0.65), rgba(45, 212, 191, 0.65));
        color: #012c1c;
      }

      @keyframes matrix-scroll {
        to {
          background-position: center, 0 280px;
        }
      }

      @keyframes auth-modal-matrix-scroll {
        to {
          background-position: 0 360px;
        }
      }

      .monitor-decoration {
        display: block;
        width: 100%;
        height: auto;
        pointer-events: none;
        user-select: none;
      }

      @media (max-width: 1024px) {
        .monitor-station {
          --screen-top: 15%;
          --screen-left: 20%;
          --screen-right: 24%;
          --screen-bottom: 46%;
          width: min(25rem, 52vw);
          max-width: 420px;
          transform: translate(-12%, 15%);
        }

        .story-card {
          top: 3.5rem;
          left: 2rem;
          transform: none;
          width: auto;
        }

        .monitor-decoration {
          width: 100%;
        }
      }

      @media (max-width: 720px) {
        body {
          overflow: auto;
        }

        .monitor-station {
          position: static;
          transform: none;
          width: 100%;
          max-width: none;
          padding: 1.5rem 1.5rem 0;
          display: flex;
          justify-content: center;
        }

        .auth-actions {
          position: static;
          top: auto;
          left: auto;
          right: auto;
          bottom: auto;
          width: min(28rem, 100%);
          justify-content: center;
          margin: 0 auto;
        }

        .auth-actions__content {
          padding: 1.5rem 1.25rem;
          height: auto;
        }

        .story-card {
          position: static;
          margin: 1.5rem;
          width: auto;
          transform: none;
        }

        .wallpaper-frame {
          position: relative;
          height: 60vh;
        }

        .monitor-decoration {
          display: none;
        }
      }

      @media (max-width: 640px) {
        .auth-modal__dialog {
          width: min(100%, 520px);
        }

        .auth-modal__content {
          padding: 1.5rem;
        }

        .auth-card--monitor {
          background: rgba(2, 6, 23, 0.82);
          border-radius: 1.35rem;
          border: 1px solid rgba(148, 163, 184, 0.18);
          box-shadow: 0 24px 48px rgba(15, 23, 42, 0.65);
          padding: clamp(1.65rem, 5vw, 2.35rem);
        }

        .auth-card--monitor::before,
        .auth-card--monitor::after {
          content: none;
        }

        .auth-card--monitor .auth-card__monitor-frame {
          display: none;
        }

        .auth-card--monitor .auth-card__monitor-content {
          position: static;
          background: transparent;
          border: none;
          padding: 0;
          box-shadow: none;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        .auth-modal,
        .auth-modal__dialog,
        .auth-card__field input[type="text"],
        .auth-card__field input[type="email"],
        .auth-card__field input[type="password"],
        .auth-card__submit,
        .auth-modal__close {
          transition: none;
        }
      }

      .wallpaper-frame {
        position: fixed;
        inset: 0;
        width: 100vw;
        height: 100vh;
        border-radius: 0;
        overflow: hidden;
        background-color: #000;
        background-size: cover;
        background-position: center;
        isolation: isolate;
      }

      .wallpaper-image {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: inherit;
        opacity: 0;
        transition: opacity 1000ms ease-in-out;
      }

      .wallpaper-image.is-visible {
        opacity: 1;
      }

      noscript {
        position: absolute;
        top: 1rem;
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.95rem;
        color: rgba(249, 250, 251, 0.75);
        text-align: center;
        background-color: rgba(0, 0, 0, 0.6);
        padding: 0.5rem 0.75rem;
        border-radius: 0.5rem;
      }
    </style>
  </head>
  <body>
    <figure>
      <div id="wallpaperFrame" class="wallpaper-frame">
        <img
          id="wallpaperImage"
          class="wallpaper-image"
          alt="Wallpaper"
          hidden
        />
      </div>
    </figure>
    <div class="monitor-station">
      <img
        class="monitor-decoration"
        src="images/index/monitor.png"
        alt="Decorative mission monitor"
        width="960"
        height="640"
        loading="lazy"
        decoding="async"
      />
      <aside class="auth-actions" aria-label="Account options">
        <div class="auth-actions__content">
          <div class="auth-screen-saver" aria-hidden="true">
            <span class="auth-screen-saver__label">Standby Mode</span>
            <span class="auth-screen-saver__divider" aria-hidden="true"></span>
            <span class="auth-screen-saver__hint">Click on screen to activate</span>
          </div>
          <div class="auth-actions__buttons" role="group" aria-label="Authentication actions">
            <a class="auth-actions__button" href="pages/login.html">Log in</a>
            <a class="auth-actions__button" href="pages/register.html">Register</a>
            <button class="auth-actions__button auth-actions__button--ghost" type="button">
              Continue as guest
            </button>
          </div>
        </div>
      </aside>
    </div>
    <div class="auth-modal" hidden aria-hidden="true">
      <div class="auth-modal__backdrop" data-auth-modal-close></div>
      <div class="auth-modal__matrix" aria-hidden="true"></div>
      <div class="auth-modal__dialog" role="dialog" aria-modal="true" aria-label="Authentication panel">
        <div class="auth-modal__content" role="document"></div>
      </div>
    </div>

    <template id="auth-modal-login">
      <div class="auth-card auth-card--monitor" data-auth-view="login">
        <img
          class="auth-card__monitor-frame"
          src="images/index/monitor2.png"
          alt=""
          aria-hidden="true"
          width="960"
          height="640"
          loading="lazy"
          decoding="async"
        />
        <div class="auth-card__monitor-content">
          <div class="auth-card__header">
            <span class="auth-card__brand">
              <img
                src="images/index/logo.png"
                alt="Dusty Nova"
                width="256"
                height="64"
                loading="lazy"
                decoding="async"
              />
            </span>
            <div class="auth-card__headline">
              <h2 class="auth-card__title">Welcome back</h2>
              <button
                class="auth-modal__close"
                type="button"
                data-auth-modal-close
                aria-label="Close authentication panel"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
          </div>
          <form class="auth-card__form">
            <div class="auth-card__field">
              <label for="authLoginEmail">Email</label>
              <input
                type="email"
                id="authLoginEmail"
                name="authLoginEmail"
                autocomplete="email"
                placeholder="you@example.com"
                required
              />
            </div>
            <div class="auth-card__field">
              <label for="authLoginPassword">Password</label>
              <input
                type="password"
                id="authLoginPassword"
                name="authLoginPassword"
                autocomplete="current-password"
                placeholder="Enter your password"
                required
              />
            </div>
            <div class="auth-card__row">
              <label>
                <input type="checkbox" name="authLoginRemember" />
                Remember me
              </label>
              <a class="auth-card__link" href="#">Forgot password?</a>
            </div>
            <button class="auth-card__submit" type="submit">Sign in</button>
          </form>
          <div class="auth-card__footer">
            New here?
            <a class="auth-card__link" href="/pages/register.html" data-auth-switch="register">Create an account</a>
          </div>
        </div>
      </div>
    </template>

    <template id="auth-modal-register">
      <div class="auth-card auth-card--monitor" data-auth-view="register">
        <img
          class="auth-card__monitor-frame"
          src="images/index/monitor2.png"
          alt=""
          aria-hidden="true"
          width="960"
          height="640"
          loading="lazy"
          decoding="async"
        />
        <div class="auth-card__monitor-content">
          <div class="auth-card__header">
            <span class="auth-card__brand">
              <img
                src="images/index/logo.png"
                alt="Dusty Nova"
                width="256"
                height="64"
                loading="lazy"
                decoding="async"
              />
            </span>
            <div class="auth-card__headline">
              <h2 class="auth-card__title">Create account</h2>
              <button
                class="auth-modal__close"
                type="button"
                data-auth-modal-close
                aria-label="Close authentication panel"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
          </div>
          <form class="auth-card__form">
            <div class="auth-card__field">
              <label for="authRegisterName">Nickname</label>
              <input
                type="text"
                id="authRegisterName"
                name="authRegisterName"
                autocomplete="name"
                placeholder="Jane Doe"
                required
              />
            </div>
            <div class="auth-card__field">
              <label for="authRegisterEmail">Email</label>
              <input
                type="email"
                id="authRegisterEmail"
                name="authRegisterEmail"
                autocomplete="email"
                placeholder="you@example.com"
                required
              />
            </div>
            <div class="auth-card__field">
              <label for="authRegisterPassword">Password</label>
              <input
                type="password"
                id="authRegisterPassword"
                name="authRegisterPassword"
                autocomplete="new-password"
                placeholder="Create a strong password"
                required
              />
            </div>
            <div class="auth-card__field">
              <label for="authRegisterConfirmPassword">Confirm password</label>
              <input
                type="password"
                id="authRegisterConfirmPassword"
                name="authRegisterConfirmPassword"
                autocomplete="new-password"
                placeholder="Repeat your password"
                required
              />
            </div>
            <label class="auth-card__terms">
              <input type="checkbox" name="authRegisterTerms" required />
              <span>
                I agree to the
                <a class="auth-card__legal-link" href="#">Terms of Service</a>
                and
                <a class="auth-card__legal-link" href="#">Privacy Policy</a>.
              </span>
            </label>
            <button class="auth-card__submit" type="submit">Create account</button>
          </form>
          <div class="auth-card__footer">
            Already have an account?
            <a class="auth-card__link" href="/pages/login.html" data-auth-switch="login">Sign in</a>
          </div>
        </div>
      </div>
    </template>

    <template id="auth-modal-guest">
      <div class="auth-card auth-card--monitor" data-auth-view="guest">
        <img
          class="auth-card__monitor-frame"
          src="images/index/monitor2.png"
          alt=""
          aria-hidden="true"
          width="960"
          height="640"
          loading="lazy"
          decoding="async"
        />
        <div class="auth-card__monitor-content">
          <div class="auth-card__header">
            <span class="auth-card__brand">
              <img
                src="images/index/logo.png"
                alt="Dusty Nova"
                width="256"
                height="64"
                loading="lazy"
                decoding="async"
              />
            </span>
            <div class="auth-card__headline">
              <h2 class="auth-card__title">Join as a guest</h2>
              <button
                class="auth-modal__close"
                type="button"
                data-auth-modal-close
                aria-label="Close authentication panel"
              >
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
          </div>
          <form class="auth-card__form">
            <div class="auth-card__field">
              <label for="authGuestNickname">Nickname</label>
              <input
                type="text"
                id="authGuestNickname"
                name="authGuestNickname"
                autocomplete="nickname"
                placeholder="Enter your nickname"
                minlength="2"
                maxlength="24"
                aria-describedby="authGuestHint"
                required
              />
            </div>
            <p class="auth-card__hint" id="authGuestHint">
              Your nickname will appear to other players during the session.
            </p>
            <button class="auth-card__submit" type="submit">Start mission</button>
          </form>
          <div class="auth-card__footer">
            Prefer a full account?
            <a class="auth-card__link" href="/pages/register.html" data-auth-switch="register">Create one now</a>
          </div>
        </div>
      </div>
    </template>

    <section class="story-card" aria-labelledby="story-card-title">
      <div class="story-card__header">
        <h2 id="story-card-title">About Dusty Nova</h2>
        <div class="story-card__nav" role="group" aria-label="Story navigation">
          <button
            class="story-card__arrow story-card__arrow--prev"
            type="button"
            aria-label="View previous section"
            disabled
          >
            <span aria-hidden="true">&#8249;</span>
          </button>
          <span class="story-card__progress" aria-live="polite">
            <span class="story-card__progress-current">1</span>
            <span aria-hidden="true">/</span>
            <span class="story-card__progress-total">3</span>
          </span>
          <button
            class="story-card__arrow story-card__arrow--next"
            type="button"
            aria-label="View next section"
          >
            <span aria-hidden="true">&#8250;</span>
          </button>
        </div>
      </div>
      <div class="story-card__body">
        <article class="story-card__section is-active" aria-hidden="false">
          <h3 class="story-card__section-title">The Frontier Beckons</h3>
          <p>
            In the not-so-distant future, humanity has set its sights on Mars, driven by the promise of
            untapped resources and new frontiers. As a pioneering miner with the Dusty Nova initiative,
            you join the vanguard tasked with extracting precious minerals scattered across the planet’s
            harsh, unpredictable terrain.
          </p>
        </article>
        <article class="story-card__section" aria-hidden="true" hidden>
          <h3 class="story-card__section-title">Beyond Mining</h3>
          <p>
            Your mission extends far beyond drilling. Establish resilient outposts, research advanced
            technologies, and protect vital dig sites from rival crews and the planet’s apex predators.
            Exploration is key—hidden beneath the red dust are rare minerals, ancient ruins, and
            abandoned settlements that whisper secrets of Mars’ mysterious past.
          </p>
        </article>
        <article class="story-card__section" aria-hidden="true" hidden>
          <h3 class="story-card__section-title">Forge Your Legacy</h3>
          <p>
            Alliances can turn the tide. Trade with fellow miners or sabotage competitors to gain an
            edge. Your decisions will shape the future of Martian colonization. Will you become a
            legendary prospector renowned for your cunning and courage, or be swallowed by the planet’s
            unforgiving landscape? The red planet awaits—adapt, fight, and survive to claim your
            fortune.
          </p>
        </article>
      </div>
    </section>
    <noscript>This page requires JavaScript to choose a random wallpaper.</noscript>

    <script>
      (function () {
        const imageDirectory = "images/wallpapers/";
        const frameElement = document.getElementById("wallpaperFrame");
        const imageElement = document.getElementById("wallpaperImage");
        const supportedExtensions = [".png", ".jpg", ".jpeg", ".webp", ".gif"];
        const SLIDE_DURATION_MS = 5000;
        const CROSS_FADE_DURATION_MS = 1000;

        const clamp01 = (value) => Math.max(0, Math.min(1, value));
        const toPercentage = (value) => `${Number((clamp01(value) * 100).toFixed(3))}%`;

        const redFrameBoundsCache = new Map();

        const waitForImageReady = (image) => {
          if (!(image instanceof HTMLImageElement)) {
            return Promise.resolve();
          }

          if (image.complete && image.naturalWidth > 0 && image.naturalHeight > 0) {
            if (typeof image.decode === "function") {
              return image.decode().catch(() => {});
            }
            return Promise.resolve();
          }

          return new Promise((resolve) => {
            const cleanup = () => {
              image.removeEventListener("load", handleLoad);
              image.removeEventListener("error", handleError);
            };

            const handleLoad = () => {
              cleanup();
              resolve();
            };

            const handleError = () => {
              cleanup();
              resolve();
            };

            image.addEventListener("load", handleLoad, { once: true });
            image.addEventListener("error", handleError, { once: true });
          });
        };

        const detectRedFrameBoundsSync = (image) => {
          const width = Math.trunc(image.naturalWidth);
          const height = Math.trunc(image.naturalHeight);

          if (!Number.isFinite(width) || !Number.isFinite(height) || width <= 0 || height <= 0) {
            return null;
          }

          let context = null;

          if (typeof OffscreenCanvas === "function") {
            try {
              const offscreenCanvas = new OffscreenCanvas(width, height);
              context =
                offscreenCanvas.getContext("2d", { willReadFrequently: true }) ||
                offscreenCanvas.getContext("2d");
              if (context) {
                context.clearRect(0, 0, width, height);
                context.drawImage(image, 0, 0, width, height);
              }
            } catch (error) {
              context = null;
            }
          }

          if (!context) {
            const canvas = document.createElement("canvas");
            canvas.width = width;
            canvas.height = height;
            context =
              canvas.getContext("2d", { willReadFrequently: true }) ||
              canvas.getContext("2d");
            if (!context) {
              return null;
            }
            context.clearRect(0, 0, width, height);
            context.drawImage(image, 0, 0, width, height);
          }

          let imageData;
          try {
            imageData = context.getImageData(0, 0, width, height);
          } catch (error) {
            return null;
          }

          const { data } = imageData;
          const stride = width * 4;

          let minX = width;
          let minY = height;
          let maxX = -1;
          let maxY = -1;
          let pixelMatches = 0;

          for (let y = 0; y < height; y += 1) {
            let offset = y * stride;
            for (let x = 0; x < width; x += 1) {
              const red = data[offset];
              const green = data[offset + 1];
              const blue = data[offset + 2];
              const alpha = data[offset + 3];

              if (alpha >= 80) {
                const maxOther = Math.max(green, blue);
                if (red > 170 && red - maxOther > 60 && green < 200 && blue < 200) {
                  if (x < minX) {
                    minX = x;
                  }
                  if (x > maxX) {
                    maxX = x;
                  }
                  if (y < minY) {
                    minY = y;
                  }
                  if (y > maxY) {
                    maxY = y;
                  }
                  pixelMatches += 1;
                }
              }

              offset += 4;
            }
          }

          if (maxX < minX || maxY < minY) {
            return null;
          }

          const boundsWidth = maxX - minX + 1;
          const boundsHeight = maxY - minY + 1;

          if (boundsWidth < width * 0.1 || boundsHeight < height * 0.1) {
            return null;
          }

          const minimumPixelMatches = Math.max(400, Math.floor(width * height * 0.002));
          if (pixelMatches < minimumPixelMatches) {
            return null;
          }

          return {
            top: minY / height,
            left: minX / width,
            right: (width - (maxX + 1)) / width,
            bottom: (height - (maxY + 1)) / height,
            imageWidth: width,
            imageHeight: height,
          };
        };

        const getRedFrameBounds = async (image) => {
          if (!(image instanceof HTMLImageElement)) {
            return null;
          }

          const cacheKey = image.currentSrc || image.src || "";
          if (cacheKey && redFrameBoundsCache.has(cacheKey)) {
            return redFrameBoundsCache.get(cacheKey) || null;
          }

          await waitForImageReady(image);

          let bounds = null;
          try {
            bounds = detectRedFrameBoundsSync(image);
          } catch (error) {
            console.error("Unable to analyse the monitor frame", error);
            bounds = null;
          }

          if (cacheKey) {
            redFrameBoundsCache.set(cacheKey, bounds);
          }

          return bounds;
        };

        const applyBoundsToElement = (element, bounds, mapping, options = {}) => {
          if (!(element instanceof HTMLElement) || !bounds) {
            return;
          }

          const {
            insetXPixels = 0,
            insetYPixels = 0,
            insetXPercent = 0,
            insetYPercent = 0,
          } = options;

          const horizontalInset =
            Math.max(0, insetXPercent) +
            (bounds.imageWidth > 0 ? insetXPixels / bounds.imageWidth : 0);
          const verticalInset =
            Math.max(0, insetYPercent) +
            (bounds.imageHeight > 0 ? insetYPixels / bounds.imageHeight : 0);

          if (mapping.top) {
            element.style.setProperty(mapping.top, toPercentage(bounds.top + verticalInset));
          }
          if (mapping.left) {
            element.style.setProperty(mapping.left, toPercentage(bounds.left + horizontalInset));
          }
          if (mapping.right) {
            element.style.setProperty(mapping.right, toPercentage(bounds.right + horizontalInset));
          }
          if (mapping.bottom) {
            element.style.setProperty(
              mapping.bottom,
              toPercentage(bounds.bottom + verticalInset),
            );
          }
        };

        const configureMonitorCardLayout = (rootElement) => {
          if (!rootElement) {
            return;
          }

          const monitorCard = rootElement.querySelector(".auth-card--monitor");
          if (!(monitorCard instanceof HTMLElement)) {
            return;
          }

          const monitorFrame = monitorCard.querySelector(".auth-card__monitor-frame");
          if (!(monitorFrame instanceof HTMLImageElement)) {
            return;
          }

          getRedFrameBounds(monitorFrame).then((bounds) => {
            if (!bounds) {
              return;
            }

            applyBoundsToElement(
              monitorCard,
              bounds,
              {
                top: "--monitor-screen-top",
                left: "--monitor-screen-left",
                right: "--monitor-screen-right",
                bottom: "--monitor-screen-bottom",
              },
              { insetXPixels: 6, insetYPixels: 6 },
            );
          });
        };

        const secondaryImageElement = imageElement.cloneNode(false);
        secondaryImageElement.removeAttribute("id");
        secondaryImageElement.removeAttribute("src");
        frameElement.appendChild(secondaryImageElement);

        const imageElements = [imageElement, secondaryImageElement];

        imageElements.forEach((img) => {
          img.hidden = true;
          img.classList.remove("is-visible");
          img.dataset.currentFile = "";
          img.decoding = "async";
          img.loading = "eager";
        });

        imageElement.removeAttribute("src");

        let activeImageElement = null;

        const getNextImageElement = () => {
          if (!activeImageElement) {
            return imageElements[0];
          }
          return imageElements.find((img) => img !== activeImageElement) || imageElements[0];
        };

        const updateAspectRatio = (img) => {
          const { naturalWidth, naturalHeight } = img;
          if (naturalWidth > 0 && naturalHeight > 0) {
            const ratio = naturalWidth / naturalHeight;
            if (Number.isFinite(ratio) && ratio > 0) {
              frameElement.style.setProperty("--wallpaper-aspect", String(ratio));
            }
          }
        };

        const encodePathSegments = (filePath) =>
          filePath
            .split("/")
            .map((segment) => encodeURIComponent(segment))
            .join("/");

        const normaliseFileName = (fileName) => {
          const trimmed = fileName.replace(/^\.\//, "");
          if (trimmed.startsWith(imageDirectory)) {
            return trimmed.slice(imageDirectory.length);
          }
          if (trimmed.startsWith("/")) {
            return trimmed.slice(1);
          }
          return trimmed;
        };

        const setWallpaper = (fileName) => {
          const normalisedFileName = normaliseFileName(fileName);

          if (
            activeImageElement &&
            activeImageElement.dataset.currentFile === normalisedFileName
          ) {
            return Promise.resolve();
          }

          const encodedName = encodePathSegments(normalisedFileName);
          const fullPath = `${imageDirectory}${encodedName}`;
          const nextImageElement = getNextImageElement();

          return new Promise((resolve, reject) => {
            const handleError = () => {
              nextImageElement.removeEventListener("load", handleLoad);
              nextImageElement.hidden = true;
              nextImageElement.classList.remove("is-visible");
              nextImageElement.removeAttribute("src");
              nextImageElement.dataset.currentFile = "";
              reject(new Error(`Unable to load wallpaper: ${normalisedFileName}`));
            };

            const handleLoad = () => {
              nextImageElement.removeEventListener("error", handleError);
              frameElement.style.backgroundImage = `url('${fullPath}')`;

              updateAspectRatio(nextImageElement);

              const previousImageElement = activeImageElement;
              activeImageElement = nextImageElement;
              nextImageElement.dataset.currentFile = normalisedFileName;
              nextImageElement.alt = `Wallpaper: ${normalisedFileName}`;

              const finaliseTransition = () => {
                if (previousImageElement) {
                  previousImageElement.hidden = true;
                  previousImageElement.classList.remove("is-visible");
                  previousImageElement.removeAttribute("src");
                  previousImageElement.dataset.currentFile = "";
                }
                resolve();
              };

              requestAnimationFrame(() => {
                nextImageElement.hidden = false;
                nextImageElement.classList.remove("is-visible");

                requestAnimationFrame(() => {
                  nextImageElement.classList.add("is-visible");

                  if (previousImageElement) {
                    previousImageElement.classList.remove("is-visible");

                    let transitionCompleted = false;
                    let fallbackTimeoutId;

                    const markTransitionComplete = () => {
                      if (transitionCompleted) {
                        return;
                      }
                      transitionCompleted = true;
                      if (fallbackTimeoutId) {
                        window.clearTimeout(fallbackTimeoutId);
                      }
                      finaliseTransition();
                    };

                    previousImageElement.addEventListener(
                      "transitionend",
                      markTransitionComplete,
                      { once: true }
                    );

                    fallbackTimeoutId = window.setTimeout(
                      markTransitionComplete,
                      CROSS_FADE_DURATION_MS + 120
                    );
                  } else {
                    finaliseTransition();
                  }
                });
              });
            };

            if (nextImageElement !== frameElement.lastElementChild) {
              frameElement.appendChild(nextImageElement);
            }

            nextImageElement.classList.remove("is-visible");
            nextImageElement.hidden = true;
            nextImageElement.dataset.currentFile = "";

            nextImageElement.addEventListener("load", handleLoad, { once: true });
            nextImageElement.addEventListener("error", handleError, { once: true });

            nextImageElement.src = fullPath;
          });
        };

        const showError = (message) => {
          frameElement.setAttribute("data-wallpaper-error", message);
          activeImageElement = null;
          imageElements.forEach((img) => {
            img.classList.remove("is-visible");
            img.hidden = true;
            img.removeAttribute("src");
            img.dataset.currentFile = "";
          });
        };

        const isImageFile = (fileName) =>
          supportedExtensions.some((extension) => fileName.toLowerCase().endsWith(extension));

        const parseDirectoryListing = (html) => {
          const parser = new DOMParser();
          const documentFragment = parser.parseFromString(html, "text/html");
          const anchors = Array.from(documentFragment.querySelectorAll("a"));

          return anchors
            .map((anchor) => anchor.getAttribute("href") || "")
            .map((href) => href.split("?")[0])
            .filter((href) => href && !href.startsWith("../"))
            .map((href) => href.replace(/^\.\//, ""))
            .filter((href) => isImageFile(href));
        };

        const dedupe = (items) => Array.from(new Set(items));

        const fetchFromManifest = async () => {
          const manifestUrl = `${imageDirectory}manifest.json`;

          const response = await fetch(manifestUrl, { cache: "no-store" });

          if (!response.ok) {
            if (response.status === 404) {
              return null;
            }
            throw new Error(`Unable to load the wallpapers manifest (${response.status}).`);
          }

          const manifest = await response.json();

          if (!Array.isArray(manifest)) {
            throw new Error("Unexpected wallpapers manifest format.");
          }

          return manifest
            .filter((file) => typeof file === "string")
            .map(normaliseFileName)
            .filter((file) => isImageFile(file));
        };

        const fetchWallpaperFiles = async () => {
          const manifestFiles = await fetchFromManifest();
          if (manifestFiles && manifestFiles.length > 0) {
            return manifestFiles;
          }

          const response = await fetch(imageDirectory, { cache: "no-store" });

          if (!response.ok) {
            throw new Error(`Unable to list wallpapers (${response.status}).`);
          }

          const contentType = response.headers.get("content-type") || "";

          if (contentType.includes("application/json")) {
            const manifest = await response.json();
            if (Array.isArray(manifest)) {
              return manifest
                .filter((file) => typeof file === "string")
                .map(normaliseFileName)
                .filter((file) => isImageFile(file));
            }
            throw new Error("Unexpected wallpapers manifest format.");
          }

          const directoryHtml = await response.text();
          return parseDirectoryListing(directoryHtml).map(normaliseFileName);
        };

        const startSlideshow = (wallpaperFiles) => {
          if (wallpaperFiles.length === 0) {
            showError("No wallpaper images were found in the wallpapers directory.");
            return;
          }

          let index = 0;

          const showNextWallpaper = async () => {
            const currentFile = wallpaperFiles[index];
            try {
              await setWallpaper(currentFile);
            } catch (error) {
              console.error(error);
              showError("Unable to display the wallpaper slideshow right now.");
            } finally {
              index = (index + 1) % wallpaperFiles.length;
              setTimeout(showNextWallpaper, SLIDE_DURATION_MS);
            }
          };

          showNextWallpaper();
        };

        const initialise = async () => {
          try {
            const wallpaperFiles = dedupe(await fetchWallpaperFiles());
            startSlideshow(wallpaperFiles);
          } catch (error) {
            console.error(error);
            showError("Unable to load wallpapers automatically. Please check the server configuration.");
          }
        };

        initialise();

        const monitorStationElement = document.querySelector(".monitor-station");
        const monitorDecorationImage = monitorStationElement?.querySelector(
          ".monitor-decoration",
        );

        if (
          monitorStationElement instanceof HTMLElement &&
          monitorDecorationImage instanceof HTMLImageElement
        ) {
          getRedFrameBounds(monitorDecorationImage).then((bounds) => {
            if (!bounds) {
              return;
            }

            applyBoundsToElement(
              monitorStationElement,
              bounds,
              {
                top: "--screen-top",
                left: "--screen-left",
                right: "--screen-right",
                bottom: "--screen-bottom",
              },
              { insetXPixels: 6, insetYPixels: 6 },
            );
          });
        }

        const guestButton = document.querySelector(
          ".auth-actions__button--ghost"
        );

        const authButtons = document.querySelectorAll(
          '.auth-actions__button[href$="login.html"], .auth-actions__button[href$="register.html"], .auth-actions__button--ghost'
        );
        const authPanel = document.querySelector(".auth-actions__content");
        const authScreenSaver = document.querySelector(".auth-screen-saver");
        const STANDBY_TIMEOUT_MS = 60 * 1000;
        let standbyTimeoutId = 0;

        const clearStandbyTimeout = () => {
          if (standbyTimeoutId) {
            window.clearTimeout(standbyTimeoutId);
            standbyTimeoutId = 0;
          }
        };

        const showAuthScreenSaver = () => {
          if (!authScreenSaver) {
            return;
          }

          clearStandbyTimeout();
          authScreenSaver.classList.remove("is-dismissed");
          authScreenSaver.setAttribute("aria-hidden", "false");

          if (authPanel) {
            authPanel.classList.add("is-screen-saver-active");
          }
        };

        const scheduleStandbyTimeout = () => {
          if (!authScreenSaver) {
            return;
          }

          clearStandbyTimeout();
          standbyTimeoutId = window.setTimeout(() => {
            showAuthScreenSaver();
          }, STANDBY_TIMEOUT_MS);
        };

        const resetStandbyTimeout = () => {
          if (!authScreenSaver || !authScreenSaver.classList.contains("is-dismissed")) {
            return;
          }

          scheduleStandbyTimeout();
        };

        function dismissAuthScreenSaver() {
          if (!authScreenSaver || authScreenSaver.classList.contains("is-dismissed")) {
            return;
          }

          authScreenSaver.classList.add("is-dismissed");
          authScreenSaver.setAttribute("aria-hidden", "true");

          if (authPanel) {
            authPanel.classList.remove("is-screen-saver-active");
          }

          scheduleStandbyTimeout();
        }

        function handleButtonPointerDown() {
          dismissAuthScreenSaver();
        }

        function handleButtonFocus() {
          dismissAuthScreenSaver();
        }

        function handleButtonKeydown(event) {
          if (event.key === "Enter" || event.key === " " || event.key === "Spacebar") {
            dismissAuthScreenSaver();
          }
        }

        if (authScreenSaver && authButtons.length) {
          authButtons.forEach((button) => {
            button.addEventListener("pointerdown", handleButtonPointerDown);
            button.addEventListener("focus", handleButtonFocus);
            button.addEventListener("keydown", handleButtonKeydown);
          });
        }

        function handlePanelPointerDown(event) {
          if (event.target instanceof HTMLElement && event.target.closest("a, button")) {
            return;
          }

          dismissAuthScreenSaver();
        }

        if (authScreenSaver && authPanel instanceof HTMLElement) {
          authScreenSaver.setAttribute("aria-hidden", "false");
          authPanel.classList.add("is-screen-saver-active");
          authPanel.addEventListener("pointerdown", handlePanelPointerDown);
        }

        const idleInteractionEvents = [
          "pointerdown",
          "pointermove",
          "keydown",
          "touchstart",
          "wheel",
          "scroll",
        ];

        idleInteractionEvents.forEach((eventName) => {
          document.addEventListener(eventName, resetStandbyTimeout, { passive: true });
        });

        if (authButtons.length) {
          const hoverSoundSource = "images/index/button_hower.mp3";
          const hoverSound = new Audio();
          hoverSound.preload = "auto";

          const prepareHoverSound = async () => {
            try {
              const response = await fetch(hoverSoundSource, { cache: "force-cache" });
              if (!response.ok) {
                throw new Error(`Unable to preload hover sound (${response.status}).`);
              }

              const audioBlob = await response.blob();
              const objectUrl = URL.createObjectURL(audioBlob);

              hoverSound.src = objectUrl;

              await new Promise((resolve) => {
                if (hoverSound.readyState >= HTMLMediaElement.HAVE_ENOUGH_DATA) {
                  resolve();
                  return;
                }
                hoverSound.addEventListener("canplaythrough", resolve, { once: true });
                hoverSound.load();
              });

              return objectUrl;
            } catch (error) {
              console.error("Unable to preload hover sound", error);
              hoverSound.src = hoverSoundSource;
              hoverSound.load();
              return null;
            }
          };

          const hoverSoundReady = prepareHoverSound();

          const attemptUnlockHoverSound = () => {
            const previousMutedState = hoverSound.muted;
            hoverSound.muted = true;
            const unlockPromise = hoverSound.play();
            const resetHoverSound = () => {
              hoverSound.pause();
              hoverSound.currentTime = 0;
              hoverSound.muted = previousMutedState;
            };

            if (unlockPromise instanceof Promise) {
              unlockPromise
                .then(resetHoverSound)
                .catch(() => {
                  hoverSound.muted = previousMutedState;
                });
            } else {
              resetHoverSound();
            }
          };

          let hoverSoundUnlockTriggered = false;

          const triggerHoverSoundUnlock = () => {
            if (hoverSoundUnlockTriggered) {
              return;
            }

            hoverSoundUnlockTriggered = true;

            const performUnlock = () => {
              try {
                attemptUnlockHoverSound();
              } catch (error) {
                console.error("Unable to unlock hover sound", error);
              }
            };

            if (hoverSoundReady) {
              hoverSoundReady
                .then(performUnlock)
                .catch(performUnlock);
            } else {
              performUnlock();
            }
          };

          const userInteractionEvents = ["pointerdown", "keydown", "touchstart", "click"];

          const handleUserInteraction = () => {
            userInteractionEvents.forEach((eventName) => {
              document.removeEventListener(eventName, handleUserInteraction);
            });

            triggerHoverSoundUnlock();
          };

          userInteractionEvents.forEach((eventName) => {
            document.addEventListener(eventName, handleUserInteraction, {
              once: true,
              passive: true,
            });
          });

          const playHoverSound = () => {
            const startPlayback = () => {
              try {
                hoverSound.currentTime = 0;
                const playPromise = hoverSound.play();
                if (playPromise instanceof Promise) {
                  playPromise.catch(() => {});
                }
              } catch (error) {
                console.error("Unable to play hover sound", error);
              }
            };

            if (hoverSoundReady) {
              hoverSoundReady
                .then((objectUrl) => {
                  if (objectUrl === null && hoverSound.src !== hoverSoundSource) {
                    hoverSound.src = hoverSoundSource;
                  }
                  startPlayback();
                })
                .catch(() => {
                  if (!hoverSound.src) {
                    hoverSound.src = hoverSoundSource;
                    hoverSound.load();
                  }
                  startPlayback();
                });
            } else {
              startPlayback();
            }
          };

          authButtons.forEach((button) => {
            button.addEventListener("mouseenter", playHoverSound);
            button.addEventListener("focus", playHoverSound);
          });

          window.addEventListener("beforeunload", () => {
            hoverSoundReady
              .then((objectUrl) => {
                if (objectUrl) {
                  URL.revokeObjectURL(objectUrl);
                }
              })
              .catch(() => {});
          });
        }

        const loginTrigger = document.querySelector(
          '.auth-actions__button[href$="login.html"]'
        );
        const registerTrigger = document.querySelector(
          '.auth-actions__button[href$="register.html"]'
        );
        const authModal = document.querySelector(".auth-modal");
        const authModalDialog = authModal?.querySelector(".auth-modal__dialog");
        const authModalContent = authModal?.querySelector(".auth-modal__content");
        let authModalClose = null;
        const loginTemplate = document.getElementById("auth-modal-login");
        const registerTemplate = document.getElementById("auth-modal-register");
        const guestTemplate = document.getElementById("auth-modal-guest");
        const modalFocusableSelectors =
          'a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])';
        let lastFocusedElement = null;
        let closeModalFallbackId = 0;

        const getTemplateForView = (view) => {
          if (view === "register") {
            return registerTemplate;
          }

          if (view === "guest") {
            return guestTemplate;
          }

          return loginTemplate;
        };

        const isTemplateElement = (template) => template instanceof HTMLTemplateElement;

        const updateBodyScrollState = (isOpen) => {
          document.body.classList.toggle("has-modal-open", Boolean(isOpen));
        };

        const trapFocusWithinModal = (event) => {
          if (!authModalDialog) {
            return;
          }

          const focusableElements = Array.from(
            authModalDialog.querySelectorAll(modalFocusableSelectors)
          ).filter(
            (element) =>
              element instanceof HTMLElement &&
              !element.hasAttribute("disabled") &&
              element.getAttribute("aria-hidden") !== "true" &&
              element.tabIndex !== -1 &&
              element.offsetParent !== null
          );

          if (focusableElements.length === 0) {
            event.preventDefault();
            return;
          }

          const [firstElement] = focusableElements;
          const lastElement = focusableElements[focusableElements.length - 1];
          const activeElement = document.activeElement;

          if (event.shiftKey) {
            if (
              activeElement === firstElement ||
              !authModalDialog.contains(activeElement)
            ) {
              event.preventDefault();
              lastElement.focus({ preventScroll: true });
            }
          } else if (activeElement === lastElement) {
            event.preventDefault();
            firstElement.focus({ preventScroll: true });
          }
        };

        const handleDocumentKeydown = (event) => {
          if (!authModal || authModal.hidden) {
            return;
          }

          if (event.key === "Escape") {
            event.preventDefault();
            closeAuthModal();
          } else if (event.key === "Tab") {
            trapFocusWithinModal(event);
          }
        };

        const wireAuthModalLinks = () => {
          if (!authModalContent) {
            return;
          }

          const switchLinks = authModalContent.querySelectorAll("[data-auth-switch]");
          switchLinks.forEach((link) => {
            link.addEventListener("click", (event) => {
              event.preventDefault();
              const targetView = link.getAttribute("data-auth-switch");
              if (
                targetView === "login" ||
                targetView === "register" ||
                targetView === "guest"
              ) {
                openAuthModal(targetView);
              }
            });
          });
        };

        const openAuthModal = (view) => {
          if (!authModal || !authModalContent || !authModalDialog) {
            return;
          }

          const template = getTemplateForView(view);
          if (!isTemplateElement(template)) {
            return;
          }

          authModalContent.innerHTML = "";
          authModalContent.appendChild(template.content.cloneNode(true));
          const closeButton = authModalDialog.querySelector(".auth-modal__close");
          authModalClose = closeButton instanceof HTMLElement ? closeButton : null;
          authModalContent.scrollTop = 0;
          configureMonitorCardLayout(authModalContent);
          wireAuthModalLinks();

          const modalLabels = {
            login: "Log in to Dusty Nova",
            register: "Create a Dusty Nova account",
            guest: "Join Dusty Nova as a guest",
          };

          authModalDialog.setAttribute(
            "aria-label",
            modalLabels[view] || "Dusty Nova authentication",
          );

          lastFocusedElement =
            document.activeElement instanceof HTMLElement ? document.activeElement : null;

          authModal.hidden = false;
          authModal.setAttribute("aria-hidden", "false");
          window.clearTimeout(closeModalFallbackId);
          closeModalFallbackId = 0;
          requestAnimationFrame(() => {
            authModal.classList.add("is-open");
          });
          updateBodyScrollState(true);
          document.addEventListener("keydown", handleDocumentKeydown, true);

          if (authModalClose instanceof HTMLElement) {
            authModalClose.focus({ preventScroll: true });
          }
        };

        const finishClosingModal = () => {
          if (!authModal || !authModalContent || authModal.hidden) {
            return;
          }

          authModal.hidden = true;
          authModalContent.innerHTML = "";
          authModalClose = null;
          document.removeEventListener("keydown", handleDocumentKeydown, true);
          updateBodyScrollState(false);

          if (closeModalFallbackId) {
            window.clearTimeout(closeModalFallbackId);
            closeModalFallbackId = 0;
          }

          const elementToRefocus = lastFocusedElement;
          lastFocusedElement = null;
          if (elementToRefocus instanceof HTMLElement) {
            elementToRefocus.focus({ preventScroll: true });
          }
        };

        const closeAuthModal = () => {
          if (!authModal || !authModalContent || authModal.hidden) {
            return;
          }

          authModal.classList.remove("is-open");
          authModal.setAttribute("aria-hidden", "true");

          const handleTransitionEnd = (event) => {
            if (event.target === authModal) {
              authModal.removeEventListener("transitionend", handleTransitionEnd);
              finishClosingModal();
            }
          };

          authModal.addEventListener("transitionend", handleTransitionEnd);
          closeModalFallbackId = window.setTimeout(() => {
            authModal.removeEventListener("transitionend", handleTransitionEnd);
            finishClosingModal();
          }, 360);
        };

        const handleAuthTriggerClick = (event) => {
          const trigger = event.currentTarget;
          if (!(trigger instanceof HTMLElement)) {
            return;
          }

          const targetView = trigger.dataset.authModalView;
          if (
            targetView === "login" ||
            targetView === "register" ||
            targetView === "guest"
          ) {
            event.preventDefault();
            openAuthModal(targetView);
          }
        };

        if (authModal instanceof HTMLElement) {
          authModal.addEventListener("click", (event) => {
            const target = event.target instanceof HTMLElement
              ? event.target.closest("[data-auth-modal-close]")
              : null;

            if (target) {
              event.preventDefault();
              closeAuthModal();
            }
          });
        }

        if (loginTrigger instanceof HTMLElement) {
          loginTrigger.dataset.authModalView = "login";
          loginTrigger.addEventListener("click", handleAuthTriggerClick);
        }

        if (registerTrigger instanceof HTMLElement) {
          registerTrigger.dataset.authModalView = "register";
          registerTrigger.addEventListener("click", handleAuthTriggerClick);
        }

        if (guestButton instanceof HTMLElement) {
          guestButton.dataset.authModalView = "guest";
          guestButton.addEventListener("click", handleAuthTriggerClick);
        }

        const storyCard = document.querySelector(".story-card");
        const storySections = storyCard
          ? Array.from(storyCard.querySelectorAll(".story-card__section"))
          : [];
        const prevArrow = storyCard?.querySelector(
          ".story-card__arrow--prev"
        );
        const nextArrow = storyCard?.querySelector(
          ".story-card__arrow--next"
        );
        const progressCurrent = storyCard?.querySelector(
          ".story-card__progress-current"
        );
        const progressTotal = storyCard?.querySelector(
          ".story-card__progress-total"
        );

        if (
          storyCard &&
          storySections.length > 0 &&
          prevArrow instanceof HTMLButtonElement &&
          nextArrow instanceof HTMLButtonElement &&
          progressCurrent instanceof HTMLElement &&
          progressTotal instanceof HTMLElement
        ) {
          let activeIndex = storySections.findIndex((section) =>
            section.classList.contains("is-active")
          );

          if (activeIndex < 0) {
            activeIndex = 0;
            storySections[0].classList.add("is-active");
          }

          const updateSectionStates = () => {
            storySections.forEach((section, index) => {
              const isActive = index === activeIndex;
              section.classList.toggle("is-active", isActive);
              section.hidden = !isActive;
              section.setAttribute("aria-hidden", String(!isActive));
            });

            progressCurrent.textContent = String(activeIndex + 1);
            progressTotal.textContent = String(storySections.length);
            prevArrow.disabled = activeIndex === 0;
            nextArrow.disabled = activeIndex === storySections.length - 1;
          };

          updateSectionStates();

          const goToIndex = (index) => {
            const targetIndex = Math.min(
              storySections.length - 1,
              Math.max(0, index)
            );

            if (targetIndex === activeIndex) {
              return;
            }

            activeIndex = targetIndex;
            updateSectionStates();
          };

          prevArrow.addEventListener("click", () => {
            goToIndex(activeIndex - 1);
          });

          nextArrow.addEventListener("click", () => {
            goToIndex(activeIndex + 1);
          });

          storyCard.addEventListener("keydown", (event) => {
            if (event.defaultPrevented) {
              return;
            }

            if (event.key === "ArrowRight") {
              event.preventDefault();
              goToIndex(activeIndex + 1);
            } else if (event.key === "ArrowLeft") {
              event.preventDefault();
              goToIndex(activeIndex - 1);
            }
          });
        }
      })();
    </script>
  </body>
</html>
