<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Resource Find Rates</title>
    <style>
      :root {
        color-scheme: dark light;
        font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      }

      body {
        margin: 0 auto;
        max-width: 1100px;
        padding: 2rem 1rem 4rem;
        line-height: 1.6;
      }

      h1 {
        font-size: clamp(2rem, 4vw, 3rem);
        margin-bottom: 0.5rem;
      }

      p.description {
        margin-top: 0;
        font-size: 1rem;
        color: #555;
        max-width: 72ch;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1.5rem;
        font-variant-numeric: tabular-nums;
      }

      caption {
        text-align: left;
        font-weight: 600;
        padding: 0.25rem 0.4rem 0.35rem;
        color: #2f2f2f;
      }

      thead th {
        text-align: left;
        border-bottom: 2px solid currentColor;
        padding: 0.5rem 0.4rem;
      }

      tbody td {
        padding: 0.45rem 0.4rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.08);
      }

      tbody tr:nth-child(even) td {
        background-color: rgba(0, 0, 0, 0.025);
      }

      .table-section + .table-section {
        margin-top: 2rem;
        padding-top: 0.25rem;
        border-top: 1px solid rgba(0, 0, 0, 0.08);
      }

      .terrain-description {
        max-width: 60ch;
      }

      @media (prefers-color-scheme: dark) {
        p.description {
          color: #c9c9c9;
        }

        caption {
          color: #f3f3f3;
        }

        tbody td {
          border-bottom-color: rgba(255, 255, 255, 0.08);
        }

        tbody tr:nth-child(even) td {
          background-color: rgba(255, 255, 255, 0.04);
        }

        .table-section + .table-section {
          border-top-color: rgba(255, 255, 255, 0.12);
        }

      }
    </style>
  </head>
  <body>
    <h1>Element Find Rates</h1>
    <p class="description">
      Each harvest attempt in the game has a 10% success chance. When a harvest
      succeeds, the element you receive is chosen with a weight of
      <code>1 / atomicNumber</code>, meaning lighter elements are more common.
      The table below shows the resulting per-element probability distribution.
    </p>

    <section class="table-section">
      <table aria-label="Element find rate table">
        <caption>Element find rates on successful harvest</caption>
        <thead>
          <tr>
            <th scope="col">#</th>
            <th scope="col">Symbol</th>
            <th scope="col">Name</th>
            <th scope="col">Chance on Success (%)</th>
          </tr>
        </thead>
        <tbody id="elements-table-body"></tbody>
      </table>
    </section>

    <section class="table-section">
      <p class="description">
        All outside terrain types pull from the exact same element pool as
        <code>samplePeriodicElement()</code>, using a <code>1 / atomicNumber</code>
        weighting across every periodic element. Terrain HP and descriptions may
        vary, but the drops are shared everywhere.
      </p>
      <table aria-label="Outside terrain reference table">
        <caption>
          Outside terrain reference
          <small>(all terrains use the same weighted element pool)</small>
        </caption>
        <thead>
          <tr>
            <th scope="col">Terrain</th>
            <th scope="col">Associated Elements</th>
            <th scope="col">HP</th>
            <th scope="col">Description</th>
          </tr>
        </thead>
        <tbody id="terrain-table-body"></tbody>
      </table>
    </section>

    <script type="module">
      import { PERIODIC_ELEMENTS } from "./scripts/data/periodic-elements.js";
      import { OUTSIDE_TERRAIN_TYPES } from "./scripts/outside-map.js";

      const elementsTableBody = document.querySelector("#elements-table-body");
      const terrainTableBody = document.querySelector("#terrain-table-body");
      const UNKNOWN_HP_LABEL = "Unknown";

      const totalWeight = PERIODIC_ELEMENTS.reduce((sum, element) => {
        if (!element || !Number.isFinite(element.number) || element.number <= 0) {
          return sum;
        }
        return sum + 1 / element.number;
      }, 0);

      const formatPercent = (value) => `${value.toFixed(4)}%`;

      PERIODIC_ELEMENTS.forEach((element) => {
        if (!element || !Number.isFinite(element.number) || element.number <= 0) {
          return;
        }

        const percent = ((1 / element.number) / totalWeight) * 100;
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${element.number}</td>
          <td>${element.symbol}</td>
          <td>${element.name}</td>
          <td>${formatPercent(percent)}</td>
        `;
        elementsTableBody.appendChild(row);
      });

      function formatTerrainHp(terrain) {
        if (!terrain || typeof terrain.hp !== "number" || terrain.hp < 0) {
          return UNKNOWN_HP_LABEL;
        }

        return `${terrain.hp}s`;
      }

      const universalElementsNote =
        "All periodic elements are possible with a 1 / atomicNumber weighting (matches samplePeriodicElement()).";

      OUTSIDE_TERRAIN_TYPES.forEach((terrain) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${terrain.label}</td>
          <td>${universalElementsNote}</td>
          <td>${formatTerrainHp(terrain)}</td>
          <td class="terrain-description">${terrain.description}</td>
        `;
        row.setAttribute(
          "aria-label",
          `${terrain.label}, elements ${universalElementsNote}, HP ${formatTerrainHp(terrain)}`
        );
        terrainTableBody.appendChild(row);
      });
    </script>
  </body>
</html>
